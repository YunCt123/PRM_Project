<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/ui/profile/ProfileViewModel.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/ui/profile/ProfileViewModel.java" />
              <option name="originalContent" value="package com.example.prm_project.ui.profile;&#10;&#10;import android.app.Application;&#10;import android.util.Log;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.lifecycle.AndroidViewModel;&#10;import androidx.lifecycle.LiveData;&#10;import androidx.lifecycle.MutableLiveData;&#10;&#10;import com.example.prm_project.api.ApiClient;&#10;import com.example.prm_project.api.UserApiService;&#10;import com.example.prm_project.models.ApiResponse;&#10;import com.example.prm_project.models.User;&#10;import com.example.prm_project.utils.SessionManager;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class ProfileViewModel extends AndroidViewModel {&#10;    private static final String TAG = &quot;ProfileViewModel&quot;;&#10;&#10;    private final MutableLiveData&lt;String&gt; mText;&#10;    private final MutableLiveData&lt;String&gt; name;&#10;    private final MutableLiveData&lt;String&gt; email;&#10;    private final MutableLiveData&lt;Integer&gt; ridesCount;&#10;    private final MutableLiveData&lt;Integer&gt; favCount;&#10;    private final MutableLiveData&lt;Integer&gt; reviewsCount;&#10;    private final MutableLiveData&lt;String&gt; distanceKm;&#10;    private final MutableLiveData&lt;Integer&gt; avatarResId;&#10;    private final MutableLiveData&lt;Integer&gt; coverResId;&#10;    private final MutableLiveData&lt;String&gt; birthDate;&#10;    private final MutableLiveData&lt;String&gt; phone;&#10;&#10;    // Loading and error states&#10;    private final MutableLiveData&lt;Boolean&gt; isLoading;&#10;    private final MutableLiveData&lt;String&gt; errorMessage;&#10;&#10;    private final UserApiService userApiService;&#10;    private final SessionManager sessionManager;&#10;&#10;    public ProfileViewModel(@NonNull Application application) {&#10;        super(application);&#10;&#10;        mText = new MutableLiveData&lt;&gt;();&#10;        mText.setValue(&quot;This is profile fragment&quot;);&#10;&#10;        // Initialize LiveData containers&#10;        name = new MutableLiveData&lt;&gt;();&#10;        email = new MutableLiveData&lt;&gt;();&#10;        ridesCount = new MutableLiveData&lt;&gt;();&#10;        favCount = new MutableLiveData&lt;&gt;();&#10;        reviewsCount = new MutableLiveData&lt;&gt;();&#10;        distanceKm = new MutableLiveData&lt;&gt;();&#10;        avatarResId = new MutableLiveData&lt;&gt;();&#10;        coverResId = new MutableLiveData&lt;&gt;();&#10;        birthDate = new MutableLiveData&lt;&gt;();&#10;        phone = new MutableLiveData&lt;&gt;();&#10;&#10;        isLoading = new MutableLiveData&lt;&gt;(false);&#10;        errorMessage = new MutableLiveData&lt;&gt;();&#10;&#10;        // Initialize API service and session manager&#10;        userApiService = ApiClient.getClient().create(UserApiService.class);&#10;        sessionManager = new SessionManager(application);&#10;&#10;        // Load initial data from API&#10;        loadUserProfile();&#10;    }&#10;&#10;    /**&#10;     * Load user profile from API&#10;     */&#10;    public void loadUserProfile() {&#10;        String token = sessionManager.getToken();&#10;&#10;        if (token == null || token.isEmpty()) {&#10;            Log.e(TAG, &quot;No token found, user not logged in&quot;);&#10;            errorMessage.setValue(&quot;Vui lòng đăng nhập lại&quot;);&#10;&#10;            // Fallback to dummy data for testing&#10;            reloadFromRepository();&#10;            return;&#10;        }&#10;&#10;        isLoading.setValue(true);&#10;        errorMessage.setValue(null);&#10;&#10;        Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.getUserProfile(&quot;Bearer &quot; + token);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                isLoading.setValue(false);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ApiResponse&lt;User&gt; apiResponse = response.body();&#10;&#10;                    if (apiResponse.isSuccess() &amp;&amp; apiResponse.getData() != null) {&#10;                        User user = apiResponse.getData();&#10;                        Log.d(TAG, &quot;Profile loaded successfully: &quot; + user.getName());&#10;&#10;                        // Update LiveData with API data&#10;                        name.setValue(user.getName() != null ? user.getName() : &quot;Unknown&quot;);&#10;                        email.setValue(user.getEmail() != null ? user.getEmail() : &quot;&quot;);&#10;                        phone.setValue(user.getPhone() != null ? user.getPhone() : &quot;&quot;);&#10;&#10;                        // Update session with latest data&#10;                        sessionManager.createLoginSession(user, token);&#10;&#10;                        // TODO: Get these from API when available&#10;                        ridesCount.setValue(0);&#10;                        favCount.setValue(0);&#10;                        reviewsCount.setValue(0);&#10;                        distanceKm.setValue(&quot;0 km&quot;);&#10;                    } else {&#10;                        Log.e(TAG, &quot;API returned success=false&quot;);&#10;                        errorMessage.setValue(&quot;Không thể tải thông tin profile&quot;);&#10;                        reloadFromRepository(); // Fallback to dummy&#10;                    }&#10;                } else {&#10;                    Log.e(TAG, &quot;API call failed with code: &quot; + response.code());&#10;                    errorMessage.setValue(&quot;Lỗi kết nối: &quot; + response.code());&#10;                    reloadFromRepository(); // Fallback to dummy&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                isLoading.setValue(false);&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;                errorMessage.setValue(&quot;Lỗi kết nối: &quot; + t.getMessage());&#10;                reloadFromRepository(); // Fallback to dummy&#10;            }&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Reloads profile data from the (dummy) repository. Call this to force-refresh&#10;     * values so observers get updated (useful during development when replacing resources).&#10;     */&#10;    public void reloadFromRepository() {&#10;        Profile p = DummyProfileRepository.getDummyProfile();&#10;&#10;        name.setValue(p.getName());&#10;        email.setValue(p.getEmail());&#10;        ridesCount.setValue(p.getRidesCount());&#10;        favCount.setValue(p.getFavCount());&#10;        reviewsCount.setValue(p.getReviewsCount());&#10;        distanceKm.setValue(p.getDistanceKm());&#10;        avatarResId.setValue(p.getAvatarResId());&#10;        coverResId.setValue(p.getCoverResId());&#10;        birthDate.setValue(p.getBirthDate());&#10;        phone.setValue(p.getPhone());&#10;    }&#10;&#10;    public LiveData&lt;String&gt; getText() {&#10;        return mText;&#10;    }&#10;&#10;    public LiveData&lt;String&gt; getName() { return name; }&#10;    public LiveData&lt;String&gt; getEmail() { return email; }&#10;    public LiveData&lt;Integer&gt; getRidesCount() { return ridesCount; }&#10;    public LiveData&lt;Integer&gt; getFavCount() { return favCount; }&#10;    public LiveData&lt;Integer&gt; getReviewsCount() { return reviewsCount; }&#10;    public LiveData&lt;String&gt; getDistanceKm() { return distanceKm; }&#10;    public LiveData&lt;Integer&gt; getAvatarResId() { return avatarResId; }&#10;    public LiveData&lt;Integer&gt; getCoverResId() { return coverResId; }&#10;    public LiveData&lt;String&gt; getBirthDate() { return birthDate; }&#10;    public LiveData&lt;String&gt; getPhone() { return phone; }&#10;&#10;    // Loading and error states&#10;    public LiveData&lt;Boolean&gt; getIsLoading() { return isLoading; }&#10;    public LiveData&lt;String&gt; getErrorMessage() { return errorMessage; }&#10;&#10;    // Setters so other fragments can update profile info (kept in-memory for now)&#10;    public void setName(String newName) { name.setValue(newName); }&#10;    public void setEmail(String newEmail) { email.setValue(newEmail); }&#10;    public void setRidesCount(int v) { ridesCount.setValue(v); }&#10;    public void setDistanceKm(String d) { distanceKm.setValue(d); }&#10;    public void setAvatarResId(int resId) { avatarResId.setValue(resId); }&#10;    public void setCoverResId(int resId) { coverResId.setValue(resId); }&#10;    public void setBirthDate(String value) { birthDate.setValue(value); }&#10;    public void setPhone(String value) { phone.setValue(value); }&#10;}" />
              <option name="updatedContent" value="package com.example.prm_project.ui.profile;&#10;&#10;import android.app.Application;&#10;import android.util.Log;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.lifecycle.AndroidViewModel;&#10;import androidx.lifecycle.LiveData;&#10;import androidx.lifecycle.MutableLiveData;&#10;&#10;import com.example.prm_project.api.ApiClient;&#10;import com.example.prm_project.api.UserApiService;&#10;import com.example.prm_project.models.ApiResponse;&#10;import com.example.prm_project.models.User;&#10;import com.example.prm_project.utils.SessionManager;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class ProfileViewModel extends AndroidViewModel {&#10;    private static final String TAG = &quot;ProfileViewModel&quot;;&#10;&#10;    private final MutableLiveData&lt;String&gt; mText;&#10;    private final MutableLiveData&lt;String&gt; name;&#10;    private final MutableLiveData&lt;String&gt; email;&#10;    private final MutableLiveData&lt;Integer&gt; ridesCount;&#10;    private final MutableLiveData&lt;Integer&gt; favCount;&#10;    private final MutableLiveData&lt;Integer&gt; reviewsCount;&#10;    private final MutableLiveData&lt;String&gt; distanceKm;&#10;    private final MutableLiveData&lt;Integer&gt; avatarResId;&#10;    private final MutableLiveData&lt;Integer&gt; coverResId;&#10;    private final MutableLiveData&lt;String&gt; birthDate;&#10;    private final MutableLiveData&lt;String&gt; phone;&#10;&#10;    // Loading and error states&#10;    private final MutableLiveData&lt;Boolean&gt; isLoading;&#10;    private final MutableLiveData&lt;String&gt; errorMessage;&#10;&#10;    private final UserApiService userApiService;&#10;    private final SessionManager sessionManager;&#10;&#10;    public ProfileViewModel(@NonNull Application application) {&#10;        super(application);&#10;&#10;        mText = new MutableLiveData&lt;&gt;();&#10;        mText.setValue(&quot;This is profile fragment&quot;);&#10;&#10;        // Initialize LiveData containers&#10;        name = new MutableLiveData&lt;&gt;();&#10;        email = new MutableLiveData&lt;&gt;();&#10;        ridesCount = new MutableLiveData&lt;&gt;();&#10;        favCount = new MutableLiveData&lt;&gt;();&#10;        reviewsCount = new MutableLiveData&lt;&gt;();&#10;        distanceKm = new MutableLiveData&lt;&gt;();&#10;        avatarResId = new MutableLiveData&lt;&gt;();&#10;        coverResId = new MutableLiveData&lt;&gt;();&#10;        birthDate = new MutableLiveData&lt;&gt;();&#10;        phone = new MutableLiveData&lt;&gt;();&#10;&#10;        isLoading = new MutableLiveData&lt;&gt;(false);&#10;        errorMessage = new MutableLiveData&lt;&gt;();&#10;&#10;        // Initialize API service and session manager&#10;        userApiService = ApiClient.getClient().create(UserApiService.class);&#10;        sessionManager = new SessionManager(application);&#10;&#10;        // Load initial data from API&#10;        loadUserProfile();&#10;    }&#10;&#10;    /**&#10;     * Load user profile from API&#10;     */&#10;    public void loadUserProfile() {&#10;        String token = sessionManager.getToken();&#10;&#10;        if (token == null || token.isEmpty()) {&#10;            Log.e(TAG, &quot;No token found, user not logged in&quot;);&#10;            errorMessage.setValue(&quot;Vui lòng đăng nhập lại&quot;);&#10;&#10;            // Fallback to dummy data for testing&#10;            reloadFromRepository();&#10;            return;&#10;        }&#10;&#10;        isLoading.setValue(true);&#10;        errorMessage.setValue(null);&#10;&#10;        Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.getUserProfile(&quot;Bearer &quot; + token);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                isLoading.setValue(false);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ApiResponse&lt;User&gt; apiResponse = response.body();&#10;&#10;                    if (apiResponse.isSuccess() &amp;&amp; apiResponse.getData() != null) {&#10;                        User user = apiResponse.getData();&#10;                        Log.d(TAG, &quot;Profile loaded successfully: &quot; + user.getName());&#10;&#10;                        // Update LiveData with API data&#10;                        name.setValue(user.getName() != null ? user.getName() : &quot;Unknown&quot;);&#10;                        email.setValue(user.getEmail() != null ? user.getEmail() : &quot;&quot;);&#10;                        phone.setValue(user.getPhone() != null ? user.getPhone() : &quot;&quot;);&#10;                        birthDate.setValue(user.getDateOfBirth() != null ? user.getDateOfBirth() : &quot;&quot;);&#10;&#10;                        // Update session with latest data&#10;                        sessionManager.createLoginSession(user, token);&#10;&#10;                        // TODO: Get these from API when available&#10;                        ridesCount.setValue(0);&#10;                        favCount.setValue(0);&#10;                        reviewsCount.setValue(0);&#10;                        distanceKm.setValue(&quot;0 km&quot;);&#10;                    } else {&#10;                        Log.e(TAG, &quot;API returned success=false&quot;);&#10;                        errorMessage.setValue(&quot;Không thể tải thông tin profile&quot;);&#10;                        reloadFromRepository(); // Fallback to dummy&#10;                    }&#10;                } else {&#10;                    Log.e(TAG, &quot;API call failed with code: &quot; + response.code());&#10;                    errorMessage.setValue(&quot;Lỗi kết nối: &quot; + response.code());&#10;                    reloadFromRepository(); // Fallback to dummy&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                isLoading.setValue(false);&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;                errorMessage.setValue(&quot;Lỗi kết nối: &quot; + t.getMessage());&#10;                reloadFromRepository(); // Fallback to dummy&#10;            }&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Reloads profile data from the (dummy) repository. Call this to force-refresh&#10;     * values so observers get updated (useful during development when replacing resources).&#10;     */&#10;    public void reloadFromRepository() {&#10;        Profile p = DummyProfileRepository.getDummyProfile();&#10;&#10;        name.setValue(p.getName());&#10;        email.setValue(p.getEmail());&#10;        ridesCount.setValue(p.getRidesCount());&#10;        favCount.setValue(p.getFavCount());&#10;        reviewsCount.setValue(p.getReviewsCount());&#10;        distanceKm.setValue(p.getDistanceKm());&#10;        avatarResId.setValue(p.getAvatarResId());&#10;        coverResId.setValue(p.getCoverResId());&#10;        birthDate.setValue(p.getBirthDate());&#10;        phone.setValue(p.getPhone());&#10;    }&#10;&#10;    public LiveData&lt;String&gt; getText() {&#10;        return mText;&#10;    }&#10;&#10;    public LiveData&lt;String&gt; getName() { return name; }&#10;    public LiveData&lt;String&gt; getEmail() { return email; }&#10;    public LiveData&lt;Integer&gt; getRidesCount() { return ridesCount; }&#10;    public LiveData&lt;Integer&gt; getFavCount() { return favCount; }&#10;    public LiveData&lt;Integer&gt; getReviewsCount() { return reviewsCount; }&#10;    public LiveData&lt;String&gt; getDistanceKm() { return distanceKm; }&#10;    public LiveData&lt;Integer&gt; getAvatarResId() { return avatarResId; }&#10;    public LiveData&lt;Integer&gt; getCoverResId() { return coverResId; }&#10;    public LiveData&lt;String&gt; getBirthDate() { return birthDate; }&#10;    public LiveData&lt;String&gt; getPhone() { return phone; }&#10;&#10;    // Loading and error states&#10;    public LiveData&lt;Boolean&gt; getIsLoading() { return isLoading; }&#10;    public LiveData&lt;String&gt; getErrorMessage() { return errorMessage; }&#10;&#10;    // Setters so other fragments can update profile info (kept in-memory for now)&#10;    public void setName(String newName) { name.setValue(newName); }&#10;    public void setEmail(String newEmail) { email.setValue(newEmail); }&#10;    public void setRidesCount(int v) { ridesCount.setValue(v); }&#10;    public void setDistanceKm(String d) { distanceKm.setValue(d); }&#10;    public void setAvatarResId(int resId) { avatarResId.setValue(resId); }&#10;    public void setCoverResId(int resId) { coverResId.setValue(resId); }&#10;    public void setBirthDate(String value) { birthDate.setValue(value); }&#10;    public void setPhone(String value) { phone.setValue(value); }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/ic_chevron_right_24dp.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/ic_chevron_right_24dp.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#2196F3&quot;&#10;        android:pathData=&quot;M9.29,6.71a1,1 0 0,0 0,1.41L13.17,12l-3.88,3.88a1,1 0 1,0 1.41,1.41l4.59,-4.59a1,1 0 0,0 0,-1.41l-4.59,-4.59a1,1 0 0,0 -1.41,0z&quot;/&gt;&#10;&lt;/vector&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#2196F3&quot;&#10;        android:pathData=&quot;M9.29,6.71a1,1 0 0,0 0,1.41L13.17,12l-3.88,3.88a1,1 0 1,0 1.41,1.41l4.59,-4.59a1,1 0 0,0 0,-1.41l-4.59,-4.59a1,1 0 0,0 -1.41,0z&quot;/&gt;&#10;&lt;/vector&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>