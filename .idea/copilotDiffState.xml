<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/activies/VerifyAccountActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/activies/VerifyAccountActivity.java" />
              <option name="originalContent" value="package com.example.prm_project.activies;&#10;&#10;import android.Manifest;&#10;import android.app.AlertDialog;&#10;import android.content.Intent;&#10;import android.content.pm.PackageManager;&#10;import android.graphics.Bitmap;&#10;import android.graphics.BitmapFactory;&#10;import android.net.Uri;&#10;import android.os.Build;&#10;import android.os.Bundle;&#10;import android.provider.MediaStore;&#10;import android.util.Log;&#10;import android.view.View;&#10;import android.widget.EditText;&#10;import android.widget.FrameLayout;&#10;import android.widget.ImageButton;&#10;import android.widget.ImageView;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.activity.result.ActivityResultLauncher;&#10;import androidx.activity.result.contract.ActivityResultContracts;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.core.app.ActivityCompat;&#10;import androidx.core.content.ContextCompat;&#10;&#10;import com.example.prm_project.R;&#10;import com.example.prm_project.api.ApiClient;&#10;import com.example.prm_project.api.UserApiService;&#10;import com.example.prm_project.models.ApiResponse;&#10;import com.example.prm_project.models.User;&#10;import com.example.prm_project.utils.SessionManager;&#10;import com.google.android.material.button.MaterialButton;&#10;&#10;import java.io.File;&#10;import java.io.FileOutputStream;&#10;import java.io.InputStream;&#10;import java.util.concurrent.ExecutorService;&#10;import java.util.concurrent.Executors;&#10;&#10;import okhttp3.MediaType;&#10;import okhttp3.MultipartBody;&#10;import okhttp3.RequestBody;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class VerifyAccountActivity extends AppCompatActivity {&#10;&#10;    private static final String TAG = &quot;VerifyAccount&quot;;&#10;    private static final int PERMISSION_REQUEST_CODE = 1001;&#10;&#10;    private ImageButton btnBack;&#10;    private FrameLayout layoutIdFront, layoutIdBack, layoutLicenseFront, layoutLicenseBack;&#10;    private ImageView ivIdFront, ivIdBack, ivLicenseFront, ivLicenseBack;&#10;    private View placeholderIdFront, placeholderIdBack, placeholderLicenseFront, placeholderLicenseBack;&#10;    private MaterialButton btnSubmit;&#10;    private TextView tvKycStatus;&#10;&#10;    private Uri idFrontUri, idBackUri, licenseFrontUri, licenseBackUri;&#10;    private int currentImageType = 0; // 1: ID Front, 2: ID Back, 3: License Front, 4: License Back&#10;&#10;    private ActivityResultLauncher&lt;Intent&gt; imagePickerLauncher;&#10;    private UserApiService userApiService;&#10;    private SessionManager sessionManager;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_verify_account);&#10;&#10;        initViews();&#10;&#10;        // Initialize session manager and API&#10;        sessionManager = new SessionManager(this);&#10;        userApiService = ApiClient.getClient().create(UserApiService.class);&#10;&#10;        // Request runtime permission early so user can pick images&#10;        checkAndRequestStoragePermission();&#10;&#10;        setupImagePicker();&#10;        setupListeners();&#10;&#10;        // Update UI according to current verification status&#10;        updateStatusFromSession();&#10;    }&#10;&#10;    private void initViews() {&#10;        btnBack = findViewById(R.id.btnBack);&#10;        layoutIdFront = findViewById(R.id.layoutIdFront);&#10;        layoutIdBack = findViewById(R.id.layoutIdBack);&#10;        layoutLicenseFront = findViewById(R.id.layoutLicenseFront);&#10;        layoutLicenseBack = findViewById(R.id.layoutLicenseBack);&#10;        btnSubmit = findViewById(R.id.btnSubmit);&#10;        tvKycStatus = findViewById(R.id.tvKycStatus);&#10;&#10;        // ImageViews for preview&#10;        ivIdFront = findViewById(R.id.ivIdFront);&#10;        ivIdBack = findViewById(R.id.ivIdBack);&#10;        ivLicenseFront = findViewById(R.id.ivLicenseFront);&#10;        ivLicenseBack = findViewById(R.id.ivLicenseBack);&#10;&#10;        // Placeholders&#10;        placeholderIdFront = findViewById(R.id.layoutIdFrontPlaceholder);&#10;        placeholderIdBack = findViewById(R.id.layoutIdBackPlaceholder);&#10;        placeholderLicenseFront = findViewById(R.id.layoutLicenseFrontPlaceholder);&#10;        placeholderLicenseBack = findViewById(R.id.layoutLicenseBackPlaceholder);&#10;    }&#10;&#10;    private void setupImagePicker() {&#10;        imagePickerLauncher = registerForActivityResult(&#10;            new ActivityResultContracts.StartActivityForResult(),&#10;            result -&gt; {&#10;                if (result.getResultCode() == RESULT_OK &amp;&amp; result.getData() != null) {&#10;                    Uri selectedImageUri = result.getData().getData();&#10;&#10;                    if (selectedImageUri == null) {&#10;                        Toast.makeText(this, &quot;Không thể lấy ảnh đã chọn&quot;, Toast.LENGTH_SHORT).show();&#10;                        return;&#10;                    }&#10;&#10;                    switch (currentImageType) {&#10;                        case 1:&#10;                            idFrontUri = selectedImageUri;&#10;                            showImagePreview(ivIdFront, placeholderIdFront, selectedImageUri);&#10;                            Toast.makeText(this, &quot;Đã chọn ảnh CMND/CCCD mặt trước&quot;, Toast.LENGTH_SHORT).show();&#10;                            break;&#10;                        case 2:&#10;                            idBackUri = selectedImageUri;&#10;                            showImagePreview(ivIdBack, placeholderIdBack, selectedImageUri);&#10;                            Toast.makeText(this, &quot;Đã chọn ảnh CMND/CCCD mặt sau&quot;, Toast.LENGTH_SHORT).show();&#10;                            break;&#10;                        case 3:&#10;                            licenseFrontUri = selectedImageUri;&#10;                            showImagePreview(ivLicenseFront, placeholderLicenseFront, selectedImageUri);&#10;                            Toast.makeText(this, &quot;Đã chọn ảnh giấy phép lái xe mặt trước&quot;, Toast.LENGTH_SHORT).show();&#10;                            break;&#10;                        case 4:&#10;                            licenseBackUri = selectedImageUri;&#10;                            showImagePreview(ivLicenseBack, placeholderLicenseBack, selectedImageUri);&#10;                            Toast.makeText(this, &quot;Đã chọn ảnh giấy phép lái xe mặt sau&quot;, Toast.LENGTH_SHORT).show();&#10;                            break;&#10;                    }&#10;&#10;                    checkAllUploaded();&#10;                }&#10;            }&#10;        );&#10;    }&#10;&#10;    private void showImagePreview(ImageView imageView, View placeholder, Uri imageUri) {&#10;        // Set image URI and show image view&#10;        imageView.setImageURI(imageUri);&#10;        imageView.setVisibility(View.VISIBLE);&#10;        placeholder.setVisibility(View.GONE);&#10;    }&#10;&#10;    private void setupListeners() {&#10;        btnBack.setOnClickListener(v -&gt; finish());&#10;&#10;        // Upload listeners - open image picker&#10;        layoutIdFront.setOnClickListener(v -&gt; {&#10;            currentImageType = 1;&#10;            openImagePicker();&#10;        });&#10;&#10;        layoutIdBack.setOnClickListener(v -&gt; {&#10;            currentImageType = 2;&#10;            openImagePicker();&#10;        });&#10;&#10;        layoutLicenseFront.setOnClickListener(v -&gt; {&#10;            currentImageType = 3;&#10;            openImagePicker();&#10;        });&#10;&#10;        layoutLicenseBack.setOnClickListener(v -&gt; {&#10;            currentImageType = 4;&#10;            openImagePicker();&#10;        });&#10;&#10;        btnSubmit.setOnClickListener(v -&gt; {&#10;            if (idFrontUri == null || idBackUri == null || licenseFrontUri == null || licenseBackUri == null) {&#10;                Toast.makeText(this, &quot;Vui lòng chọn đầy đủ ảnh giấy tờ&quot;, Toast.LENGTH_SHORT).show();&#10;                return;&#10;            }&#10;&#10;            uploadKYCDocuments();&#10;        });&#10;    }&#10;&#10;    private void openImagePicker() {&#10;        Intent intent = new Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);&#10;        imagePickerLauncher.launch(intent);&#10;    }&#10;&#10;    private void checkAllUploaded() {&#10;        if (idFrontUri != null &amp;&amp; idBackUri != null &amp;&amp; licenseFrontUri != null &amp;&amp; licenseBackUri != null) {&#10;            btnSubmit.setEnabled(true);&#10;            btnSubmit.setBackgroundTintList(getResources().getColorStateList(R.color.primary_green, null));&#10;        }&#10;    }&#10;&#10;    private void uploadKYCDocuments() {&#10;        // Show loading&#10;        btnSubmit.setEnabled(false);&#10;        btnSubmit.setText(&quot;Đang chuẩn bị...&quot;);&#10;&#10;        // Get token from SessionManager&#10;        String token = sessionManager.getToken();&#10;        Log.d(TAG, &quot;Token: &quot; + token);&#10;        if (token == null || token.isEmpty()) {&#10;            Toast.makeText(this, &quot;Vui lòng đăng nhập lại&quot;, Toast.LENGTH_SHORT).show();&#10;            finish();&#10;            return;&#10;        }&#10;&#10;        // Move heavy image processing to background thread&#10;        ExecutorService executor = Executors.newSingleThreadExecutor();&#10;        executor.execute(() -&gt; {&#10;            try {&#10;                // Convert URIs to MultipartBody.Part in background thread&#10;                MultipartBody.Part idFrontPart = prepareFilePart(&quot;kyc.idFrontImage&quot;, idFrontUri);&#10;                MultipartBody.Part idBackPart = prepareFilePart(&quot;kyc.idBackImage&quot;, idBackUri);&#10;                MultipartBody.Part licenseFrontPart = prepareFilePart(&quot;kyc.licenseFrontImage&quot;, licenseFrontUri);&#10;                MultipartBody.Part licenseBackPart = prepareFilePart(&quot;kyc.licenseBackImage&quot;, licenseBackUri);&#10;&#10;                Log.d(TAG, &quot;Files prepared: &quot; + (idFrontPart != null) + &quot;, &quot; + (idBackPart != null) + &quot;, &quot; + (licenseFrontPart != null) + &quot;, &quot; + (licenseBackPart != null));&#10;&#10;                // Return to main thread to check results and call API&#10;                runOnUiThread(() -&gt; {&#10;                    if (idFrontPart == null || idBackPart == null || licenseFrontPart == null || licenseBackPart == null) {&#10;                        Toast.makeText(this, &quot;Lỗi khi chuẩn bị file, vui lòng thử lại&quot;, Toast.LENGTH_SHORT).show();&#10;                        btnSubmit.setEnabled(true);&#10;                        btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                        return;&#10;                    }&#10;&#10;                    btnSubmit.setText(&quot;Đang tải lên...&quot;);&#10;&#10;                    // Get current user from session&#10;                    User currentUser = sessionManager.getUserDetails();&#10;                    String userName = (currentUser != null &amp;&amp; currentUser.getName() != null) ? currentUser.getName().trim() : &quot;&quot;;&#10;&#10;                    if (userName.isEmpty()) {&#10;                        // Backend requires 'name' field — ask user to update profile&#10;                        EditText input = new EditText(VerifyAccountActivity.this);&#10;                        input.setHint(&quot;Họ và tên&quot;);&#10;                        new AlertDialog.Builder(VerifyAccountActivity.this)&#10;                                .setTitle(&quot;Tên bắt buộc&quot;)&#10;                                .setMessage(&quot;Backend yêu cầu trường tên. Vui lòng nhập tên để tiếp tục gửi xác minh.&quot;)&#10;                                .setView(input)&#10;                                .setPositiveButton(&quot;Gửi&quot;, (dialog, which) -&gt; {&#10;                                    String entered = input.getText() != null ? input.getText().toString().trim() : &quot;&quot;;&#10;                                    if (entered.isEmpty()) {&#10;                                        Toast.makeText(VerifyAccountActivity.this, &quot;Tên không được để trống&quot;, Toast.LENGTH_SHORT).show();&#10;                                        btnSubmit.setEnabled(true);&#10;                                        btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                                        return;&#10;                                    }&#10;                                    submitWithName(entered, currentUser, token, idFrontPart, idBackPart, licenseFrontPart, licenseBackPart);&#10;                                })&#10;                                .setNegativeButton(&quot;Hủy&quot;, (dialog, which) -&gt; {&#10;                                    btnSubmit.setEnabled(true);&#10;                                    btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                                    dialog.dismiss();&#10;                                })&#10;                                .setCancelable(false)&#10;                                .show();&#10;                        return;&#10;                    }&#10;&#10;                    // Create multipart text part for name&#10;                    MultipartBody.Part namePart = MultipartBody.Part.createFormData(&quot;name&quot;, null, RequestBody.create(MediaType.parse(&quot;text/plain&quot;), userName));&#10;                    RequestBody phone = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), (currentUser != null &amp;&amp; currentUser.getPhone() != null) ? currentUser.getPhone() : &quot;&quot;);&#10;                    RequestBody gender = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), (currentUser != null &amp;&amp; currentUser.getGender() != null) ? currentUser.getGender() : &quot;&quot;);&#10;&#10;                    // Call API&#10;                    Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.updateProfile(&#10;                        &quot;Bearer &quot; + token,&#10;                        namePart,&#10;                        phone,&#10;                        gender,&#10;                        null,&#10;                        licenseFrontPart,&#10;                        licenseBackPart,&#10;                        idFrontPart,&#10;                        idBackPart&#10;                    );&#10;&#10;                    call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;                        @Override&#10;                        public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                            btnSubmit.setEnabled(true);&#10;                            btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;&#10;                            Log.d(TAG, &quot;Response code: &quot; + response.code());&#10;&#10;                            if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                                ApiResponse&lt;User&gt; apiResponse = response.body();&#10;                                Log.d(TAG, &quot;Response success: &quot; + apiResponse.isSuccess() + &quot;, message: &quot; + apiResponse.getMessage());&#10;                                if (apiResponse.isSuccess()) {&#10;                                    User updatedUser = apiResponse.getData();&#10;&#10;                                    if (updatedUser != null) {&#10;                                        sessionManager.createLoginSession(updatedUser, token);&#10;                                        Log.d(TAG, &quot;Updated user saved to session. KYC status: &quot; + updatedUser.getVerificationStatus());&#10;                                    }&#10;&#10;                                    updateStatusFromSession();&#10;&#10;                                    Toast.makeText(VerifyAccountActivity.this,&#10;                                        &quot;Đã gửi yêu cầu xác minh thành công!&quot;,&#10;                                        Toast.LENGTH_LONG).show();&#10;                                } else {&#10;                                    Log.e(TAG, &quot;API returned success=false: &quot; + apiResponse.getMessage());&#10;                                    Toast.makeText(VerifyAccountActivity.this,&#10;                                        &quot;Lỗi: &quot; + apiResponse.getMessage(),&#10;                                        Toast.LENGTH_SHORT).show();&#10;                                }&#10;                            } else {&#10;                                String err = &quot;Không thể kết nối server. Code: &quot; + response.code();&#10;                                try {&#10;                                    if (response.errorBody() != null) {&#10;                                        String errBody = response.errorBody().string();&#10;                                        Log.e(TAG, &quot;Error body: &quot; + errBody);&#10;                                        err += &quot;\n&quot; + errBody;&#10;                                    }&#10;                                } catch (Exception ex) {&#10;                                    Log.w(TAG, &quot;Error reading errorBody&quot;, ex);&#10;                                }&#10;                                Toast.makeText(VerifyAccountActivity.this, err, Toast.LENGTH_LONG).show();&#10;                            }&#10;                        }&#10;&#10;                        @Override&#10;                        public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                            btnSubmit.setEnabled(true);&#10;                            btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                            Log.e(TAG, &quot;Upload failure: &quot; + t.getClass().getSimpleName() + &quot; - &quot; + t.getMessage(), t);&#10;&#10;                            String errorMsg = &quot;Lỗi kết nối: &quot;;&#10;                            if (t instanceof java.net.SocketTimeoutException) {&#10;                                errorMsg += &quot;Timeout - kiểm tra kết nối mạng hoặc thử ảnh nhỏ hơn&quot;;&#10;                            } else if (t instanceof java.net.UnknownHostException) {&#10;                                errorMsg += &quot;Không thể kết nối server - kiểm tra internet&quot;;&#10;                            } else {&#10;                                errorMsg += t.getMessage();&#10;                            }&#10;&#10;                            Toast.makeText(VerifyAccountActivity.this, errorMsg, Toast.LENGTH_LONG).show();&#10;                        }&#10;                    });&#10;                });&#10;&#10;            } catch (Exception e) {&#10;                Log.e(TAG, &quot;Exception in background thread&quot;, e);&#10;                runOnUiThread(() -&gt; {&#10;                    btnSubmit.setEnabled(true);&#10;                    btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                    Toast.makeText(this, &quot;Lỗi: &quot; + e.getMessage(), Toast.LENGTH_SHORT).show();&#10;                });&#10;            } finally {&#10;                executor.shutdown();&#10;            }&#10;        });&#10;    }&#10;&#10;    private MultipartBody.Part prepareFilePart(String partName, Uri fileUri) {&#10;        try {&#10;            if (fileUri == null) return null;&#10;&#10;            // Create a temporary file&#10;            File file = new File(getCacheDir(), &quot;upload_&quot; + System.currentTimeMillis() + &quot;.jpg&quot;);&#10;&#10;            // Copy and COMPRESS content from Uri to file&#10;            InputStream inputStream = getContentResolver().openInputStream(fileUri);&#10;            if (inputStream == null) {&#10;                Log.w(TAG, &quot;Input stream is null for uri: &quot; + fileUri);&#10;                return null;&#10;            }&#10;&#10;            // Decode and compress bitmap to reduce file size&#10;            Bitmap bitmap = BitmapFactory.decodeStream(inputStream);&#10;            inputStream.close();&#10;&#10;            if (bitmap == null) {&#10;                Log.w(TAG, &quot;Failed to decode bitmap from uri: &quot; + fileUri);&#10;                return null;&#10;            }&#10;&#10;            // Compress to JPEG with quality 70% to reduce size significantly&#10;            FileOutputStream outputStream = new FileOutputStream(file);&#10;            bitmap.compress(Bitmap.CompressFormat.JPEG, 70, outputStream);&#10;            outputStream.close();&#10;            bitmap.recycle();&#10;&#10;            Log.d(TAG, &quot;Compressed file &quot; + partName + &quot;: &quot; + file.length() + &quot; bytes&quot;);&#10;&#10;            // Create RequestBody&#10;            RequestBody requestFile = RequestBody.create(&#10;                MediaType.parse(&quot;image/jpeg&quot;),&#10;                file&#10;            );&#10;&#10;            return MultipartBody.Part.createFormData(partName, file.getName(), requestFile);&#10;&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;prepareFilePart error for &quot; + partName, e);&#10;            return null;&#10;        }&#10;    }&#10;&#10;    private void checkAndRequestStoragePermission() {&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.TIRAMISU) {&#10;            // Android 13+: READ_MEDIA_IMAGES&#10;            if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_MEDIA_IMAGES) != PackageManager.PERMISSION_GRANTED) {&#10;                ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_MEDIA_IMAGES}, PERMISSION_REQUEST_CODE);&#10;            }&#10;        } else {&#10;            // Older versions: READ_EXTERNAL_STORAGE&#10;            if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {&#10;                ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_EXTERNAL_STORAGE}, PERMISSION_REQUEST_CODE);&#10;            }&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {&#10;        super.onRequestPermissionsResult(requestCode, permissions, grantResults);&#10;        if (requestCode == PERMISSION_REQUEST_CODE) {&#10;            if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {&#10;                Toast.makeText(this, &quot;Đã cấp quyền truy cập ảnh&quot;, Toast.LENGTH_SHORT).show();&#10;            } else {&#10;                Toast.makeText(this, &quot;Cần cấp quyền để chọn ảnh&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        }&#10;    }&#10;&#10;    private void updateStatusFromSession() {&#10;        if (sessionManager == null) return;&#10;        String kyc = sessionManager.getKycStatus();&#10;        boolean verified = sessionManager.isVerified();&#10;&#10;        String statusText = &quot;Trạng thái: &quot;;&#10;        if (verified) {&#10;            statusText += &quot;Đã xác minh&quot;;&#10;            disableInputsForStatus();&#10;        } else if (kyc != null &amp;&amp; (kyc.equalsIgnoreCase(&quot;pending&quot;) || kyc.equalsIgnoreCase(&quot;submitted&quot;))) {&#10;            statusText += &quot;Đang chờ xác minh&quot;;&#10;            disableInputsForStatus();&#10;        } else {&#10;            statusText += &quot;Chưa gửi&quot;;&#10;            enableInputsForEditing();&#10;        }&#10;&#10;        tvKycStatus.setText(statusText);&#10;    }&#10;&#10;    private void disableInputsForStatus() {&#10;        layoutIdFront.setClickable(false);&#10;        layoutIdBack.setClickable(false);&#10;        layoutLicenseFront.setClickable(false);&#10;        layoutLicenseBack.setClickable(false);&#10;        btnSubmit.setEnabled(false);&#10;    }&#10;&#10;    private void enableInputsForEditing() {&#10;        layoutIdFront.setClickable(true);&#10;        layoutIdBack.setClickable(true);&#10;        layoutLicenseFront.setClickable(true);&#10;        layoutLicenseBack.setClickable(true);&#10;        // btnSubmit will be enabled only after all images selected&#10;        checkAllUploaded();&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        // Refresh profile from backend to get latest KYC status when user returns&#10;        refreshProfileFromApi();&#10;    }&#10;&#10;    private void refreshProfileFromApi() {&#10;        if (sessionManager == null || userApiService == null) return;&#10;        String token = sessionManager.getToken();&#10;        if (token == null || token.isEmpty()) return;&#10;&#10;        Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.getUserProfile(&quot;Bearer &quot; + token);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null &amp;&amp; response.body().isSuccess()) {&#10;                    User user = response.body().getData();&#10;                    if (user != null) {&#10;                        // Persist the latest user (including kyc/isVerified)&#10;                        sessionManager.createLoginSession(user, token);&#10;                        // Update UI&#10;                        updateStatusFromSession();&#10;                        Log.d(TAG, &quot;Profile refreshed, kyc=&quot; + user.getVerificationStatus());&#10;                    }&#10;                } else {&#10;                    Log.w(TAG, &quot;refreshProfileFromApi failed: code=&quot; + response.code());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                Log.w(TAG, &quot;refreshProfileFromApi onFailure&quot;, t);&#10;            }&#10;        });&#10;    }&#10;&#10;    // Helper to submit when name was entered by user in dialog&#10;    private void submitWithName(String enteredName, User currentUser, String token,&#10;                                MultipartBody.Part idFrontPart,&#10;                                MultipartBody.Part idBackPart,&#10;                                MultipartBody.Part licenseFrontPart,&#10;                                MultipartBody.Part licenseBackPart) {&#10;        btnSubmit.setEnabled(false);&#10;        btnSubmit.setText(&quot;Đang tải lên...&quot;);&#10;&#10;        RequestBody nameRb = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), enteredName);&#10;        RequestBody phone = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), (currentUser != null &amp;&amp; currentUser.getPhone() != null) ? currentUser.getPhone() : &quot;&quot;);&#10;        RequestBody gender = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), (currentUser != null &amp;&amp; currentUser.getGender() != null) ? currentUser.getGender() : &quot;&quot;);&#10;        MultipartBody.Part namePart = MultipartBody.Part.createFormData(&quot;name&quot;, null, nameRb);&#10;&#10;        Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.updateProfile(&#10;                &quot;Bearer &quot; + token,&#10;                namePart,&#10;                phone,&#10;                gender,&#10;                null,&#10;                licenseFrontPart,&#10;                licenseBackPart,&#10;                idFrontPart,&#10;                idBackPart&#10;        );&#10;&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                btnSubmit.setEnabled(true);&#10;                btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;&#10;                Log.d(TAG, &quot;submitWithName Response code: &quot; + response.code());&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null &amp;&amp; response.body().isSuccess()) {&#10;                    User updatedUser = response.body().getData();&#10;                    if (updatedUser != null) {&#10;                        sessionManager.createLoginSession(updatedUser, token);&#10;                        updateStatusFromSession();&#10;                        Log.d(TAG, &quot;User updated with name. KYC: &quot; + updatedUser.getVerificationStatus());&#10;                    }&#10;                    Toast.makeText(VerifyAccountActivity.this, &quot;Đã gửi yêu cầu xác minh thành công!&quot;, Toast.LENGTH_LONG).show();&#10;                } else {&#10;                    String err = &quot;Không thể gửi. Code: &quot; + response.code();&#10;                    try {&#10;                        if (response.errorBody() != null) {&#10;                            String errBody = response.errorBody().string();&#10;                            Log.e(TAG, &quot;submitWithName error body: &quot; + errBody);&#10;                            err += &quot;\n&quot; + errBody;&#10;                        }&#10;                    } catch (Exception ex) {&#10;                        Log.w(TAG, &quot;Error reading errorBody&quot;, ex);&#10;                    }&#10;                    Toast.makeText(VerifyAccountActivity.this, err, Toast.LENGTH_LONG).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                btnSubmit.setEnabled(true);&#10;                btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                Log.e(TAG, &quot;submitWithName failure: &quot; + t.getClass().getSimpleName() + &quot; - &quot; + t.getMessage(), t);&#10;&#10;                String errorMsg = &quot;Lỗi: &quot;;&#10;                if (t instanceof java.net.SocketTimeoutException) {&#10;                    errorMsg += &quot;Timeout - thử lại hoặc dùng ảnh nhỏ hơn&quot;;&#10;                } else if (t instanceof java.net.UnknownHostException) {&#10;                    errorMsg += &quot;Không có kết nối internet&quot;;&#10;                } else {&#10;                    errorMsg += t.getMessage();&#10;                }&#10;&#10;                Toast.makeText(VerifyAccountActivity.this, errorMsg, Toast.LENGTH_LONG).show();&#10;            }&#10;        });&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_project.activies;&#10;&#10;import android.Manifest;&#10;import android.app.AlertDialog;&#10;import android.content.Intent;&#10;import android.content.pm.PackageManager;&#10;import android.graphics.Bitmap;&#10;import android.graphics.BitmapFactory;&#10;import android.net.Uri;&#10;import android.os.Build;&#10;import android.os.Bundle;&#10;import android.provider.MediaStore;&#10;import android.util.Log;&#10;import android.view.View;&#10;import android.widget.EditText;&#10;import android.widget.FrameLayout;&#10;import android.widget.ImageButton;&#10;import android.widget.ImageView;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.activity.result.ActivityResultLauncher;&#10;import androidx.activity.result.contract.ActivityResultContracts;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.core.app.ActivityCompat;&#10;import androidx.core.content.ContextCompat;&#10;&#10;import com.example.prm_project.R;&#10;import com.example.prm_project.api.ApiClient;&#10;import com.example.prm_project.api.UserApiService;&#10;import com.example.prm_project.models.ApiResponse;&#10;import com.example.prm_project.models.User;&#10;import com.example.prm_project.utils.SessionManager;&#10;import com.google.android.material.button.MaterialButton;&#10;&#10;import java.io.File;&#10;import java.io.FileOutputStream;&#10;import java.io.InputStream;&#10;import java.util.concurrent.ExecutorService;&#10;import java.util.concurrent.Executors;&#10;&#10;import okhttp3.MediaType;&#10;import okhttp3.MultipartBody;&#10;import okhttp3.RequestBody;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class VerifyAccountActivity extends AppCompatActivity {&#10;&#10;    private static final String TAG = &quot;VerifyAccount&quot;;&#10;    private static final int PERMISSION_REQUEST_CODE = 1001;&#10;&#10;    private ImageButton btnBack;&#10;    private FrameLayout layoutIdFront, layoutIdBack, layoutLicenseFront, layoutLicenseBack;&#10;    private ImageView ivIdFront, ivIdBack, ivLicenseFront, ivLicenseBack;&#10;    private View placeholderIdFront, placeholderIdBack, placeholderLicenseFront, placeholderLicenseBack;&#10;    private MaterialButton btnSubmit;&#10;    private TextView tvKycStatus;&#10;&#10;    private Uri idFrontUri, idBackUri, licenseFrontUri, licenseBackUri;&#10;    private int currentImageType = 0; // 1: ID Front, 2: ID Back, 3: License Front, 4: License Back&#10;&#10;    private ActivityResultLauncher&lt;Intent&gt; imagePickerLauncher;&#10;    private UserApiService userApiService;&#10;    private SessionManager sessionManager;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_verify_account);&#10;&#10;        initViews();&#10;&#10;        // Initialize session manager and API&#10;        sessionManager = new SessionManager(this);&#10;        userApiService = ApiClient.getClient().create(UserApiService.class);&#10;&#10;        // Request runtime permission early so user can pick images&#10;        checkAndRequestStoragePermission();&#10;&#10;        setupImagePicker();&#10;        setupListeners();&#10;&#10;        // Update UI according to current verification status&#10;        updateStatusFromSession();&#10;    }&#10;&#10;    private void initViews() {&#10;        btnBack = findViewById(R.id.btnBack);&#10;        layoutIdFront = findViewById(R.id.layoutIdFront);&#10;        layoutIdBack = findViewById(R.id.layoutIdBack);&#10;        layoutLicenseFront = findViewById(R.id.layoutLicenseFront);&#10;        layoutLicenseBack = findViewById(R.id.layoutLicenseBack);&#10;        btnSubmit = findViewById(R.id.btnSubmit);&#10;        tvKycStatus = findViewById(R.id.tvKycStatus);&#10;&#10;        // ImageViews for preview&#10;        ivIdFront = findViewById(R.id.ivIdFront);&#10;        ivIdBack = findViewById(R.id.ivIdBack);&#10;        ivLicenseFront = findViewById(R.id.ivLicenseFront);&#10;        ivLicenseBack = findViewById(R.id.ivLicenseBack);&#10;&#10;        // Placeholders&#10;        placeholderIdFront = findViewById(R.id.layoutIdFrontPlaceholder);&#10;        placeholderIdBack = findViewById(R.id.layoutIdBackPlaceholder);&#10;        placeholderLicenseFront = findViewById(R.id.layoutLicenseFrontPlaceholder);&#10;        placeholderLicenseBack = findViewById(R.id.layoutLicenseBackPlaceholder);&#10;    }&#10;&#10;    private void setupImagePicker() {&#10;        imagePickerLauncher = registerForActivityResult(&#10;            new ActivityResultContracts.StartActivityForResult(),&#10;            result -&gt; {&#10;                if (result.getResultCode() == RESULT_OK &amp;&amp; result.getData() != null) {&#10;                    Uri selectedImageUri = result.getData().getData();&#10;&#10;                    if (selectedImageUri == null) {&#10;                        Toast.makeText(this, &quot;Không thể lấy ảnh đã chọn&quot;, Toast.LENGTH_SHORT).show();&#10;                        return;&#10;                    }&#10;&#10;                    switch (currentImageType) {&#10;                        case 1:&#10;                            idFrontUri = selectedImageUri;&#10;                            showImagePreview(ivIdFront, placeholderIdFront, selectedImageUri);&#10;                            Toast.makeText(this, &quot;Đã chọn ảnh CMND/CCCD mặt trước&quot;, Toast.LENGTH_SHORT).show();&#10;                            break;&#10;                        case 2:&#10;                            idBackUri = selectedImageUri;&#10;                            showImagePreview(ivIdBack, placeholderIdBack, selectedImageUri);&#10;                            Toast.makeText(this, &quot;Đã chọn ảnh CMND/CCCD mặt sau&quot;, Toast.LENGTH_SHORT).show();&#10;                            break;&#10;                        case 3:&#10;                            licenseFrontUri = selectedImageUri;&#10;                            showImagePreview(ivLicenseFront, placeholderLicenseFront, selectedImageUri);&#10;                            Toast.makeText(this, &quot;Đã chọn ảnh giấy phép lái xe mặt trước&quot;, Toast.LENGTH_SHORT).show();&#10;                            break;&#10;                        case 4:&#10;                            licenseBackUri = selectedImageUri;&#10;                            showImagePreview(ivLicenseBack, placeholderLicenseBack, selectedImageUri);&#10;                            Toast.makeText(this, &quot;Đã chọn ảnh giấy phép lái xe mặt sau&quot;, Toast.LENGTH_SHORT).show();&#10;                            break;&#10;                    }&#10;&#10;                    checkAllUploaded();&#10;                }&#10;            }&#10;        );&#10;    }&#10;&#10;    private void showImagePreview(ImageView imageView, View placeholder, Uri imageUri) {&#10;        // Set image URI and show image view&#10;        imageView.setImageURI(imageUri);&#10;        imageView.setVisibility(View.VISIBLE);&#10;        placeholder.setVisibility(View.GONE);&#10;    }&#10;&#10;    private void setupListeners() {&#10;        btnBack.setOnClickListener(v -&gt; finish());&#10;&#10;        // Upload listeners - open image picker&#10;        layoutIdFront.setOnClickListener(v -&gt; {&#10;            currentImageType = 1;&#10;            openImagePicker();&#10;        });&#10;&#10;        layoutIdBack.setOnClickListener(v -&gt; {&#10;            currentImageType = 2;&#10;            openImagePicker();&#10;        });&#10;&#10;        layoutLicenseFront.setOnClickListener(v -&gt; {&#10;            currentImageType = 3;&#10;            openImagePicker();&#10;        });&#10;&#10;        layoutLicenseBack.setOnClickListener(v -&gt; {&#10;            currentImageType = 4;&#10;            openImagePicker();&#10;        });&#10;&#10;        btnSubmit.setOnClickListener(v -&gt; {&#10;            if (idFrontUri == null || idBackUri == null || licenseFrontUri == null || licenseBackUri == null) {&#10;                Toast.makeText(this, &quot;Vui lòng chọn đầy đủ ảnh giấy tờ&quot;, Toast.LENGTH_SHORT).show();&#10;                return;&#10;            }&#10;&#10;            uploadKYCDocuments();&#10;        });&#10;    }&#10;&#10;    private void openImagePicker() {&#10;        Intent intent = new Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);&#10;        imagePickerLauncher.launch(intent);&#10;    }&#10;&#10;    private void checkAllUploaded() {&#10;        if (idFrontUri != null &amp;&amp; idBackUri != null &amp;&amp; licenseFrontUri != null &amp;&amp; licenseBackUri != null) {&#10;            btnSubmit.setEnabled(true);&#10;            btnSubmit.setBackgroundTintList(getResources().getColorStateList(R.color.primary_green, null));&#10;        }&#10;    }&#10;&#10;    private void uploadKYCDocuments() {&#10;        // Show loading&#10;        btnSubmit.setEnabled(false);&#10;        btnSubmit.setText(&quot;Đang chuẩn bị...&quot;);&#10;&#10;        // Get token from SessionManager&#10;        String token = sessionManager.getToken();&#10;        Log.d(TAG, &quot;Token: &quot; + token);&#10;        if (token == null || token.isEmpty()) {&#10;            Toast.makeText(this, &quot;Vui lòng đăng nhập lại&quot;, Toast.LENGTH_SHORT).show();&#10;            finish();&#10;            return;&#10;        }&#10;&#10;        // Move heavy image processing to background thread&#10;        ExecutorService executor = Executors.newSingleThreadExecutor();&#10;        executor.execute(() -&gt; {&#10;            try {&#10;                // Convert URIs to MultipartBody.Part in background thread&#10;                MultipartBody.Part idFrontPart = prepareFilePart(&quot;kyc.idFrontImage&quot;, idFrontUri);&#10;                MultipartBody.Part idBackPart = prepareFilePart(&quot;kyc.idBackImage&quot;, idBackUri);&#10;                MultipartBody.Part licenseFrontPart = prepareFilePart(&quot;kyc.licenseFrontImage&quot;, licenseFrontUri);&#10;                MultipartBody.Part licenseBackPart = prepareFilePart(&quot;kyc.licenseBackImage&quot;, licenseBackUri);&#10;&#10;                Log.d(TAG, &quot;Files prepared: &quot; + (idFrontPart != null) + &quot;, &quot; + (idBackPart != null) + &quot;, &quot; + (licenseFrontPart != null) + &quot;, &quot; + (licenseBackPart != null));&#10;&#10;                // Return to main thread to check results and call API&#10;                runOnUiThread(() -&gt; {&#10;                    if (idFrontPart == null || idBackPart == null || licenseFrontPart == null || licenseBackPart == null) {&#10;                        Toast.makeText(this, &quot;Lỗi khi chuẩn bị file, vui lòng thử lại&quot;, Toast.LENGTH_SHORT).show();&#10;                        btnSubmit.setEnabled(true);&#10;                        btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                        return;&#10;                    }&#10;&#10;                    btnSubmit.setText(&quot;Đang tải lên...&quot;);&#10;&#10;                    // Get current user from session&#10;                    User currentUser = sessionManager.getUserDetails();&#10;                    String userName = (currentUser != null &amp;&amp; currentUser.getName() != null) ? currentUser.getName().trim() : &quot;&quot;;&#10;&#10;                    if (userName.isEmpty()) {&#10;                        // Backend requires 'name' field — ask user to update profile&#10;                        EditText input = new EditText(VerifyAccountActivity.this);&#10;                        input.setHint(&quot;Họ và tên&quot;);&#10;                        new AlertDialog.Builder(VerifyAccountActivity.this)&#10;                                .setTitle(&quot;Tên bắt buộc&quot;)&#10;                                .setMessage(&quot;Backend yêu cầu trường tên. Vui lòng nhập tên để tiếp tục gửi xác minh.&quot;)&#10;                                .setView(input)&#10;                                .setPositiveButton(&quot;Gửi&quot;, (dialog, which) -&gt; {&#10;                                    String entered = input.getText() != null ? input.getText().toString().trim() : &quot;&quot;;&#10;                                    if (entered.isEmpty()) {&#10;                                        Toast.makeText(VerifyAccountActivity.this, &quot;Tên không được để trống&quot;, Toast.LENGTH_SHORT).show();&#10;                                        btnSubmit.setEnabled(true);&#10;                                        btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                                        return;&#10;                                    }&#10;                                    submitWithName(entered, currentUser, token, idFrontPart, idBackPart, licenseFrontPart, licenseBackPart);&#10;                                })&#10;                                .setNegativeButton(&quot;Hủy&quot;, (dialog, which) -&gt; {&#10;                                    btnSubmit.setEnabled(true);&#10;                                    btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                                    dialog.dismiss();&#10;                                })&#10;                                .setCancelable(false)&#10;                                .show();&#10;                        return;&#10;                    }&#10;&#10;                    // Create multipart text part for name&#10;                    MultipartBody.Part namePart = MultipartBody.Part.createFormData(&quot;name&quot;, null, RequestBody.create(MediaType.parse(&quot;text/plain&quot;), userName));&#10;                    RequestBody phone = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), (currentUser != null &amp;&amp; currentUser.getPhone() != null) ? currentUser.getPhone() : &quot;&quot;);&#10;                    RequestBody gender = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), (currentUser != null &amp;&amp; currentUser.getGender() != null) ? currentUser.getGender() : &quot;&quot;);&#10;&#10;                    // Call API&#10;                    Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.updateProfile(&#10;                        &quot;Bearer &quot; + token,&#10;                        namePart,&#10;                        phone,&#10;                        gender,&#10;                        null,&#10;                        licenseFrontPart,&#10;                        licenseBackPart,&#10;                        idFrontPart,&#10;                        idBackPart&#10;                    );&#10;&#10;                    call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;                        @Override&#10;                        public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                            btnSubmit.setEnabled(true);&#10;                            btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;&#10;                            Log.d(TAG, &quot;Response code: &quot; + response.code());&#10;&#10;                            if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                                ApiResponse&lt;User&gt; apiResponse = response.body();&#10;                                Log.d(TAG, &quot;Response success: &quot; + apiResponse.isSuccess() + &quot;, message: &quot; + apiResponse.getMessage());&#10;                                if (apiResponse.isSuccess()) {&#10;                                    User updatedUser = apiResponse.getData();&#10;&#10;                                    if (updatedUser != null) {&#10;                                        sessionManager.createLoginSession(updatedUser, token);&#10;                                        Log.d(TAG, &quot;Updated user saved to session. KYC status: &quot; + updatedUser.getVerificationStatus());&#10;                                    }&#10;&#10;                                    updateStatusFromSession();&#10;&#10;                                    Toast.makeText(VerifyAccountActivity.this,&#10;                                        &quot;Đã gửi yêu cầu xác minh thành công!&quot;,&#10;                                        Toast.LENGTH_LONG).show();&#10;                                } else {&#10;                                    Log.e(TAG, &quot;API returned success=false: &quot; + apiResponse.getMessage());&#10;                                    Toast.makeText(VerifyAccountActivity.this,&#10;                                        &quot;Lỗi: &quot; + apiResponse.getMessage(),&#10;                                        Toast.LENGTH_SHORT).show();&#10;                                }&#10;                            } else {&#10;                                String err = &quot;Không thể kết nối server. Code: &quot; + response.code();&#10;                                try {&#10;                                    if (response.errorBody() != null) {&#10;                                        String errBody = response.errorBody().string();&#10;                                        Log.e(TAG, &quot;Error body: &quot; + errBody);&#10;                                        err += &quot;\n&quot; + errBody;&#10;                                    }&#10;                                } catch (Exception ex) {&#10;                                    Log.w(TAG, &quot;Error reading errorBody&quot;, ex);&#10;                                }&#10;                                Toast.makeText(VerifyAccountActivity.this, err, Toast.LENGTH_LONG).show();&#10;                            }&#10;                        }&#10;&#10;                        @Override&#10;                        public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                            btnSubmit.setEnabled(true);&#10;                            btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                            Log.e(TAG, &quot;Upload failure: &quot; + t.getClass().getSimpleName() + &quot; - &quot; + t.getMessage(), t);&#10;&#10;                            String errorMsg = &quot;Lỗi kết nối: &quot;;&#10;                            if (t instanceof java.net.SocketTimeoutException) {&#10;                                errorMsg += &quot;Timeout - kiểm tra kết nối mạng hoặc thử ảnh nhỏ hơn&quot;;&#10;                            } else if (t instanceof java.net.UnknownHostException) {&#10;                                errorMsg += &quot;Không thể kết nối server - kiểm tra internet&quot;;&#10;                            } else {&#10;                                errorMsg += t.getMessage();&#10;                            }&#10;&#10;                            Toast.makeText(VerifyAccountActivity.this, errorMsg, Toast.LENGTH_LONG).show();&#10;                        }&#10;                    });&#10;                });&#10;&#10;            } catch (Exception e) {&#10;                Log.e(TAG, &quot;Exception in background thread&quot;, e);&#10;                runOnUiThread(() -&gt; {&#10;                    btnSubmit.setEnabled(true);&#10;                    btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                    Toast.makeText(this, &quot;Lỗi: &quot; + e.getMessage(), Toast.LENGTH_SHORT).show();&#10;                });&#10;            } finally {&#10;                executor.shutdown();&#10;            }&#10;        });&#10;    }&#10;&#10;    private MultipartBody.Part prepareFilePart(String partName, Uri fileUri) {&#10;        try {&#10;            if (fileUri == null) return null;&#10;&#10;            // Create a temporary file&#10;            File file = new File(getCacheDir(), &quot;upload_&quot; + System.currentTimeMillis() + &quot;.jpg&quot;);&#10;&#10;            // Copy and COMPRESS content from Uri to file&#10;            InputStream inputStream = getContentResolver().openInputStream(fileUri);&#10;            if (inputStream == null) {&#10;                Log.w(TAG, &quot;Input stream is null for uri: &quot; + fileUri);&#10;                return null;&#10;            }&#10;&#10;            // Decode and compress bitmap to reduce file size&#10;            Bitmap bitmap = BitmapFactory.decodeStream(inputStream);&#10;            inputStream.close();&#10;&#10;            if (bitmap == null) {&#10;                Log.w(TAG, &quot;Failed to decode bitmap from uri: &quot; + fileUri);&#10;                return null;&#10;            }&#10;&#10;            // Compress to JPEG with quality 70% to reduce size significantly&#10;            FileOutputStream outputStream = new FileOutputStream(file);&#10;            bitmap.compress(Bitmap.CompressFormat.JPEG, 70, outputStream);&#10;            outputStream.close();&#10;            bitmap.recycle();&#10;&#10;            Log.d(TAG, &quot;Compressed file &quot; + partName + &quot;: &quot; + file.length() + &quot; bytes&quot;);&#10;&#10;            // Create RequestBody&#10;            RequestBody requestFile = RequestBody.create(&#10;                MediaType.parse(&quot;image/jpeg&quot;),&#10;                file&#10;            );&#10;&#10;            return MultipartBody.Part.createFormData(partName, file.getName(), requestFile);&#10;&#10;        } catch (Exception e) {&#10;            Log.e(TAG, &quot;prepareFilePart error for &quot; + partName, e);&#10;            return null;&#10;        }&#10;    }&#10;&#10;    private void checkAndRequestStoragePermission() {&#10;        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.TIRAMISU) {&#10;            // Android 13+: READ_MEDIA_IMAGES&#10;            if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_MEDIA_IMAGES) != PackageManager.PERMISSION_GRANTED) {&#10;                ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_MEDIA_IMAGES}, PERMISSION_REQUEST_CODE);&#10;            }&#10;        } else {&#10;            // Older versions: READ_EXTERNAL_STORAGE&#10;            if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {&#10;                ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_EXTERNAL_STORAGE}, PERMISSION_REQUEST_CODE);&#10;            }&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {&#10;        super.onRequestPermissionsResult(requestCode, permissions, grantResults);&#10;        if (requestCode == PERMISSION_REQUEST_CODE) {&#10;            if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {&#10;                Toast.makeText(this, &quot;Đã cấp quyền truy cập ảnh&quot;, Toast.LENGTH_SHORT).show();&#10;            } else {&#10;                Toast.makeText(this, &quot;Cần cấp quyền để chọn ảnh&quot;, Toast.LENGTH_SHORT).show();&#10;            }&#10;        }&#10;    }&#10;&#10;    private void updateStatusFromSession() {&#10;        if (sessionManager == null) return;&#10;        String kycStatus = sessionManager.getKycStatus();&#10;        boolean verified = sessionManager.isVerified();&#10;&#10;        String statusText = &quot;Trạng thái: &quot;;&#10;        if (verified) {&#10;            statusText += &quot;✅ Đã xác minh&quot;;&#10;            tvKycStatus.setTextColor(getResources().getColor(android.R.color.holo_green_dark, null));&#10;            disableInputsForStatus();&#10;        } else if (kycStatus != null &amp;&amp; kycStatus.equalsIgnoreCase(&quot;pending&quot;)) {&#10;            statusText += &quot;⏳ Đang chờ xác minh&quot;;&#10;            tvKycStatus.setTextColor(getResources().getColor(android.R.color.holo_orange_dark, null));&#10;            disableInputsForStatus();&#10;        } else {&#10;            statusText += &quot;⚠️ Chưa gửi&quot;;&#10;            tvKycStatus.setTextColor(getResources().getColor(android.R.color.darker_gray, null));&#10;            enableInputsForEditing();&#10;        }&#10;&#10;        tvKycStatus.setText(statusText);&#10;        Log.d(TAG, &quot;Status updated: verified=&quot; + verified + &quot;, kycStatus=&quot; + kycStatus);&#10;    }&#10;&#10;    private void disableInputsForStatus() {&#10;        layoutIdFront.setClickable(false);&#10;        layoutIdBack.setClickable(false);&#10;        layoutLicenseFront.setClickable(false);&#10;        layoutLicenseBack.setClickable(false);&#10;        btnSubmit.setEnabled(false);&#10;    }&#10;&#10;    private void enableInputsForEditing() {&#10;        layoutIdFront.setClickable(true);&#10;        layoutIdBack.setClickable(true);&#10;        layoutLicenseFront.setClickable(true);&#10;        layoutLicenseBack.setClickable(true);&#10;        // btnSubmit will be enabled only after all images selected&#10;        checkAllUploaded();&#10;    }&#10;&#10;    @Override&#10;    protected void onResume() {&#10;        super.onResume();&#10;        // Refresh profile from backend to get latest KYC status when user returns&#10;        refreshProfileFromApi();&#10;    }&#10;&#10;    private void refreshProfileFromApi() {&#10;        if (sessionManager == null || userApiService == null) return;&#10;        String token = sessionManager.getToken();&#10;        if (token == null || token.isEmpty()) return;&#10;&#10;        Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.getUserProfile(&quot;Bearer &quot; + token);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null &amp;&amp; response.body().isSuccess()) {&#10;                    User user = response.body().getData();&#10;                    if (user != null) {&#10;                        // Persist the latest user (including kyc/isVerified)&#10;                        sessionManager.createLoginSession(user, token);&#10;                        // Update UI&#10;                        updateStatusFromSession();&#10;                        Log.d(TAG, &quot;Profile refreshed, kyc=&quot; + user.getVerificationStatus());&#10;                    }&#10;                } else {&#10;                    Log.w(TAG, &quot;refreshProfileFromApi failed: code=&quot; + response.code());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                Log.w(TAG, &quot;refreshProfileFromApi onFailure&quot;, t);&#10;            }&#10;        });&#10;    }&#10;&#10;    // Helper to submit when name was entered by user in dialog&#10;    private void submitWithName(String enteredName, User currentUser, String token,&#10;                                MultipartBody.Part idFrontPart,&#10;                                MultipartBody.Part idBackPart,&#10;                                MultipartBody.Part licenseFrontPart,&#10;                                MultipartBody.Part licenseBackPart) {&#10;        btnSubmit.setEnabled(false);&#10;        btnSubmit.setText(&quot;Đang tải lên...&quot;);&#10;&#10;        RequestBody nameRb = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), enteredName);&#10;        RequestBody phone = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), (currentUser != null &amp;&amp; currentUser.getPhone() != null) ? currentUser.getPhone() : &quot;&quot;);&#10;        RequestBody gender = RequestBody.create(MediaType.parse(&quot;text/plain&quot;), (currentUser != null &amp;&amp; currentUser.getGender() != null) ? currentUser.getGender() : &quot;&quot;);&#10;        MultipartBody.Part namePart = MultipartBody.Part.createFormData(&quot;name&quot;, null, nameRb);&#10;&#10;        Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.updateProfile(&#10;                &quot;Bearer &quot; + token,&#10;                namePart,&#10;                phone,&#10;                gender,&#10;                null,&#10;                licenseFrontPart,&#10;                licenseBackPart,&#10;                idFrontPart,&#10;                idBackPart&#10;        );&#10;&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                btnSubmit.setEnabled(true);&#10;                btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;&#10;                Log.d(TAG, &quot;submitWithName Response code: &quot; + response.code());&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null &amp;&amp; response.body().isSuccess()) {&#10;                    User updatedUser = response.body().getData();&#10;                    if (updatedUser != null) {&#10;                        sessionManager.createLoginSession(updatedUser, token);&#10;                        updateStatusFromSession();&#10;                        Log.d(TAG, &quot;User updated with name. KYC: &quot; + updatedUser.getVerificationStatus());&#10;                    }&#10;                    Toast.makeText(VerifyAccountActivity.this, &quot;Đã gửi yêu cầu xác minh thành công!&quot;, Toast.LENGTH_LONG).show();&#10;                } else {&#10;                    String err = &quot;Không thể gửi. Code: &quot; + response.code();&#10;                    try {&#10;                        if (response.errorBody() != null) {&#10;                            String errBody = response.errorBody().string();&#10;                            Log.e(TAG, &quot;submitWithName error body: &quot; + errBody);&#10;                            err += &quot;\n&quot; + errBody;&#10;                        }&#10;                    } catch (Exception ex) {&#10;                        Log.w(TAG, &quot;Error reading errorBody&quot;, ex);&#10;                    }&#10;                    Toast.makeText(VerifyAccountActivity.this, err, Toast.LENGTH_LONG).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                btnSubmit.setEnabled(true);&#10;                btnSubmit.setText(&quot;Gửi xác minh&quot;);&#10;                Log.e(TAG, &quot;submitWithName failure: &quot; + t.getClass().getSimpleName() + &quot; - &quot; + t.getMessage(), t);&#10;&#10;                String errorMsg = &quot;Lỗi: &quot;;&#10;                if (t instanceof java.net.SocketTimeoutException) {&#10;                    errorMsg += &quot;Timeout - thử lại hoặc dùng ảnh nhỏ hơn&quot;;&#10;                } else if (t instanceof java.net.UnknownHostException) {&#10;                    errorMsg += &quot;Không có kết nối internet&quot;;&#10;                } else {&#10;                    errorMsg += t.getMessage();&#10;                }&#10;&#10;                Toast.makeText(VerifyAccountActivity.this, errorMsg, Toast.LENGTH_LONG).show();&#10;            }&#10;        });&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/api/UserApiService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/api/UserApiService.java" />
              <option name="originalContent" value="package com.example.prm_project.api;&#10;&#10;import com.example.prm_project.models.ApiResponse;&#10;import com.example.prm_project.models.User;&#10;&#10;import okhttp3.MultipartBody;&#10;import okhttp3.RequestBody;&#10;import retrofit2.Call;&#10;import retrofit2.http.GET;&#10;import retrofit2.http.Header;&#10;import retrofit2.http.Multipart;&#10;import retrofit2.http.PATCH;&#10;import retrofit2.http.Part;&#10;&#10;/**&#10; * API Service interface cho User endpoints&#10; */&#10;public interface UserApiService {&#10;&#10;    /**&#10;     * Get current user profile&#10;     * GET /api/users/me&#10;     * @param token Authorization Bearer token&#10;     * @return ApiResponse với User data&#10;     */&#10;    @GET(&quot;api/users/me&quot;)&#10;    Call&lt;ApiResponse&lt;User&gt;&gt; getUserProfile(&#10;            @Header(&quot;Authorization&quot;) String token&#10;    );&#10;&#10;    /**&#10;     * Update user profile with KYC documents&#10;     * PATCH /api/users/me&#10;     * @param token Authorization Bearer token&#10;     * @param namePart Multipart part containing name (form field 'name')&#10;     * @param phone Số điện thoại&#10;     * @param gender Giới tính&#10;     * @param avatar File ảnh đại diện&#10;     * @param licenseFrontImage Ảnh mặt trước giấy phép lái xe&#10;     * @param licenseBackImage Ảnh mặt sau giấy phép lái xe&#10;     * @param idFrontImage Ảnh mặt trước CMND/CCCD&#10;     * @param idBackImage Ảnh mặt sau CMND/CCCD&#10;     * @return ApiResponse với User data&#10;     */&#10;    @Multipart&#10;    @PATCH(&quot;api/users/me&quot;)&#10;    Call&lt;ApiResponse&lt;User&gt;&gt; updateProfile(&#10;            @Header(&quot;Authorization&quot;) String token,&#10;            @Part MultipartBody.Part namePart,&#10;            @Part(&quot;phone&quot;) RequestBody phone,&#10;            @Part(&quot;gender&quot;) RequestBody gender,&#10;            @Part MultipartBody.Part avatar,&#10;            @Part MultipartBody.Part licenseFrontImage,&#10;            @Part MultipartBody.Part licenseBackImage,&#10;            @Part MultipartBody.Part idFrontImage,&#10;            @Part MultipartBody.Part idBackImage&#10;    );&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_project.api;&#10;&#10;import com.example.prm_project.models.ApiResponse;&#10;import com.example.prm_project.models.User;&#10;import com.example.prm_project.models.UserUpdateRequest;&#10;&#10;import okhttp3.MultipartBody;&#10;import okhttp3.RequestBody;&#10;import retrofit2.Call;&#10;import retrofit2.http.Body;&#10;import retrofit2.http.GET;&#10;import retrofit2.http.Header;&#10;import retrofit2.http.Multipart;&#10;import retrofit2.http.PATCH;&#10;import retrofit2.http.Part;&#10;&#10;/**&#10; * API Service interface cho User endpoints&#10; */&#10;public interface UserApiService {&#10;&#10;    /**&#10;     * Get current user profile&#10;     * GET /api/users/me&#10;     * @param token Authorization Bearer token&#10;     * @return ApiResponse với User data&#10;     */&#10;    @GET(&quot;api/users/me&quot;)&#10;    Call&lt;ApiResponse&lt;User&gt;&gt; getUserProfile(&#10;            @Header(&quot;Authorization&quot;) String token&#10;    );&#10;&#10;    /**&#10;     * Update basic user profile info (name, email, dateOfBirth, phone)&#10;     * PATCH /api/users/me&#10;     * @param token Authorization Bearer token&#10;     * @param request UserUpdateRequest with fields to update&#10;     * @return ApiResponse với User data&#10;     */&#10;    @PATCH(&quot;api/users/me&quot;)&#10;    Call&lt;ApiResponse&lt;User&gt;&gt; updateBasicProfile(&#10;            @Header(&quot;Authorization&quot;) String token,&#10;            @Body UserUpdateRequest request&#10;    );&#10;&#10;    /**&#10;     * Update user profile with KYC documents&#10;     * PATCH /api/users/me&#10;     * @param token Authorization Bearer token&#10;     * @param namePart Multipart part containing name (form field 'name')&#10;     * @param phone Số điện thoại&#10;     * @param gender Giới tính&#10;     * @param avatar File ảnh đại diện&#10;     * @param licenseFrontImage Ảnh mặt trước giấy phép lái xe&#10;     * @param licenseBackImage Ảnh mặt sau giấy phép lái xe&#10;     * @param idFrontImage Ảnh mặt trước CMND/CCCD&#10;     * @param idBackImage Ảnh mặt sau CMND/CCCD&#10;     * @return ApiResponse với User data&#10;     */&#10;    @Multipart&#10;    @PATCH(&quot;api/users/me&quot;)&#10;    Call&lt;ApiResponse&lt;User&gt;&gt; updateProfile(&#10;            @Header(&quot;Authorization&quot;) String token,&#10;            @Part MultipartBody.Part namePart,&#10;            @Part(&quot;phone&quot;) RequestBody phone,&#10;            @Part(&quot;gender&quot;) RequestBody gender,&#10;            @Part MultipartBody.Part avatar,&#10;            @Part MultipartBody.Part licenseFrontImage,&#10;            @Part MultipartBody.Part licenseBackImage,&#10;            @Part MultipartBody.Part idFrontImage,&#10;            @Part MultipartBody.Part idBackImage&#10;    );&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/models/User.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/models/User.java" />
              <option name="originalContent" value="package com.example.prm_project.models;&#10;&#10;import com.google.gson.annotations.SerializedName;&#10;&#10;/**&#10; * User model representing user data from API&#10; */&#10;public class User {&#10;&#10;    @SerializedName(&quot;_id&quot;)&#10;    private String id;&#10;&#10;    @SerializedName(&quot;name&quot;)&#10;    private String name;&#10;&#10;    @SerializedName(&quot;email&quot;)&#10;    private String email;&#10;&#10;    @SerializedName(&quot;phone&quot;)&#10;    private String phone;&#10;&#10;    @SerializedName(&quot;gender&quot;)&#10;    private String gender;&#10;&#10;    @SerializedName(&quot;role&quot;)&#10;    private String role;&#10;&#10;    @SerializedName(&quot;createdAt&quot;)&#10;    private String createdAt;&#10;&#10;    @SerializedName(&quot;updatedAt&quot;)&#10;    private String updatedAt;&#10;&#10;    // Fix: backend uses &quot;verified&quot;, not &quot;isVerified&quot;&#10;    @SerializedName(&quot;verified&quot;)&#10;    private Boolean verified;&#10;&#10;    @SerializedName(&quot;verifiedAt&quot;)&#10;    private String verifiedAt;&#10;&#10;    @SerializedName(&quot;kyc&quot;)&#10;    private Kyc kyc;&#10;&#10;    public static class Kyc {&#10;        @SerializedName(&quot;idFrontImage&quot;)&#10;        private String idFrontImage;&#10;&#10;        @SerializedName(&quot;idBackImage&quot;)&#10;        private String idBackImage;&#10;&#10;        @SerializedName(&quot;licenseFrontImage&quot;)&#10;        private String licenseFrontImage;&#10;&#10;        @SerializedName(&quot;licenseBackImage&quot;)&#10;        private String licenseBackImage;&#10;&#10;        @SerializedName(&quot;verifiedAt&quot;)&#10;        private String verifiedAt;&#10;&#10;        public String getIdFrontImage() { return idFrontImage; }&#10;        public void setIdFrontImage(String idFrontImage) { this.idFrontImage = idFrontImage; }&#10;&#10;        public String getIdBackImage() { return idBackImage; }&#10;        public void setIdBackImage(String idBackImage) { this.idBackImage = idBackImage; }&#10;&#10;        public String getLicenseFrontImage() { return licenseFrontImage; }&#10;        public void setLicenseFrontImage(String licenseFrontImage) { this.licenseFrontImage = licenseFrontImage; }&#10;&#10;        public String getLicenseBackImage() { return licenseBackImage; }&#10;        public void setLicenseBackImage(String licenseBackImage) { this.licenseBackImage = licenseBackImage; }&#10;&#10;        public String getVerifiedAt() { return verifiedAt; }&#10;        public void setVerifiedAt(String verifiedAt) { this.verifiedAt = verifiedAt; }&#10;    }&#10;&#10;    // Constructors&#10;    public User() {&#10;    }&#10;&#10;    public User(String id, String name, String email, String phone, String gender, String role) {&#10;        this.id = id;&#10;        this.name = name;&#10;        this.email = email;&#10;        this.phone = phone;&#10;        this.gender = gender;&#10;        this.role = role;&#10;    }&#10;&#10;    // Getters and Setters&#10;    public String getId() {&#10;        return id;&#10;    }&#10;&#10;    public void setId(String id) {&#10;        this.id = id;&#10;    }&#10;&#10;    public String getName() {&#10;        return name;&#10;    }&#10;&#10;    public void setName(String name) {&#10;        this.name = name;&#10;    }&#10;&#10;    public String getEmail() {&#10;        return email;&#10;    }&#10;&#10;    public void setEmail(String email) {&#10;        this.email = email;&#10;    }&#10;&#10;    public String getPhone() {&#10;        return phone;&#10;    }&#10;&#10;    public void setPhone(String phone) {&#10;        this.phone = phone;&#10;    }&#10;&#10;    public String getGender() {&#10;        return gender;&#10;    }&#10;&#10;    public void setGender(String gender) {&#10;        this.gender = gender;&#10;    }&#10;&#10;    public String getRole() {&#10;        return role;&#10;    }&#10;&#10;    public void setRole(String role) {&#10;        this.role = role;&#10;    }&#10;&#10;    public String getCreatedAt() {&#10;        return createdAt;&#10;    }&#10;&#10;    public void setCreatedAt(String createdAt) {&#10;        this.createdAt = createdAt;&#10;    }&#10;&#10;    public String getUpdatedAt() {&#10;        return updatedAt;&#10;    }&#10;&#10;    public void setUpdatedAt(String updatedAt) {&#10;        this.updatedAt = updatedAt;&#10;    }&#10;&#10;    // Verification helpers - updated to use &quot;verified&quot; field&#10;    public Boolean getIsVerified() {&#10;        return verified != null ? verified : false;&#10;    }&#10;&#10;    public void setIsVerified(Boolean verified) {&#10;        this.verified = verified;&#10;    }&#10;&#10;    public Boolean getVerified() {&#10;        return verified != null ? verified : false;&#10;    }&#10;&#10;    public void setVerified(Boolean verified) {&#10;        this.verified = verified;&#10;    }&#10;&#10;    public String getVerifiedAt() {&#10;        return verifiedAt;&#10;    }&#10;&#10;    public void setVerifiedAt(String verifiedAt) {&#10;        this.verifiedAt = verifiedAt;&#10;    }&#10;&#10;    public Kyc getKyc() { return kyc; }&#10;    public void setKyc(Kyc kyc) { this.kyc = kyc; }&#10;&#10;    /**&#10;     * Returns a simple verification status string: &quot;verified&quot;, &quot;pending&quot;, or &quot;unverified&quot;&#10;     */&#10;    public String getVerificationStatus() {&#10;        // If verified is true and has verifiedAt date, user is fully verified&#10;        if (verified != null &amp;&amp; verified &amp;&amp; verifiedAt != null) {&#10;            return &quot;verified&quot;;&#10;        }&#10;        // If has KYC images uploaded but not yet verified, status is pending&#10;        if (kyc != null &amp;&amp;&#10;            kyc.getIdFrontImage() != null &amp;&amp;&#10;            kyc.getIdBackImage() != null &amp;&amp;&#10;            kyc.getLicenseFrontImage() != null &amp;&amp;&#10;            kyc.getLicenseBackImage() != null) {&#10;            return &quot;pending&quot;;&#10;        }&#10;        return &quot;unverified&quot;;&#10;    }&#10;&#10;    @Override&#10;    public String toString() {&#10;        return &quot;User{&quot; + &quot;id='&quot; + id + '\'' + &quot;, name='&quot; + name + '\'' + &quot;, email='&quot; + email + '\'' + &quot;, phone='&quot; + phone + '\'' + &quot;, gender='&quot; + gender + '\'' + &quot;, role='&quot; + role + '\'' + &quot;, verified=&quot; + verified + '}';&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_project.models;&#10;&#10;import com.google.gson.annotations.SerializedName;&#10;&#10;/**&#10; * User model representing user data from API&#10; */&#10;public class User {&#10;&#10;    @SerializedName(&quot;_id&quot;)&#10;    private String id;&#10;&#10;    @SerializedName(&quot;name&quot;)&#10;    private String name;&#10;&#10;    @SerializedName(&quot;email&quot;)&#10;    private String email;&#10;&#10;    @SerializedName(&quot;phone&quot;)&#10;    private String phone;&#10;&#10;    @SerializedName(&quot;dateOfBirth&quot;)&#10;    private String dateOfBirth;&#10;&#10;    @SerializedName(&quot;gender&quot;)&#10;    private String gender;&#10;&#10;    @SerializedName(&quot;role&quot;)&#10;    private String role;&#10;&#10;    @SerializedName(&quot;createdAt&quot;)&#10;    private String createdAt;&#10;&#10;    @SerializedName(&quot;updatedAt&quot;)&#10;    private String updatedAt;&#10;&#10;    // Fix: backend uses &quot;verified&quot;, not &quot;isVerified&quot;&#10;    @SerializedName(&quot;verified&quot;)&#10;    private Boolean verified;&#10;&#10;    @SerializedName(&quot;verifiedAt&quot;)&#10;    private String verifiedAt;&#10;&#10;    @SerializedName(&quot;kyc&quot;)&#10;    private Kyc kyc;&#10;&#10;    public static class Kyc {&#10;        @SerializedName(&quot;idFrontImage&quot;)&#10;        private String idFrontImage;&#10;&#10;        @SerializedName(&quot;idBackImage&quot;)&#10;        private String idBackImage;&#10;&#10;        @SerializedName(&quot;licenseFrontImage&quot;)&#10;        private String licenseFrontImage;&#10;&#10;        @SerializedName(&quot;licenseBackImage&quot;)&#10;        private String licenseBackImage;&#10;&#10;        @SerializedName(&quot;verifiedAt&quot;)&#10;        private String verifiedAt;&#10;&#10;        public String getIdFrontImage() { return idFrontImage; }&#10;        public void setIdFrontImage(String idFrontImage) { this.idFrontImage = idFrontImage; }&#10;&#10;        public String getIdBackImage() { return idBackImage; }&#10;        public void setIdBackImage(String idBackImage) { this.idBackImage = idBackImage; }&#10;&#10;        public String getLicenseFrontImage() { return licenseFrontImage; }&#10;        public void setLicenseFrontImage(String licenseFrontImage) { this.licenseFrontImage = licenseFrontImage; }&#10;&#10;        public String getLicenseBackImage() { return licenseBackImage; }&#10;        public void setLicenseBackImage(String licenseBackImage) { this.licenseBackImage = licenseBackImage; }&#10;&#10;        public String getVerifiedAt() { return verifiedAt; }&#10;        public void setVerifiedAt(String verifiedAt) { this.verifiedAt = verifiedAt; }&#10;    }&#10;&#10;    // Constructors&#10;    public User() {&#10;    }&#10;&#10;    public User(String id, String name, String email, String phone, String dateOfBirth, String gender, String role) {&#10;        this.id = id;&#10;        this.name = name;&#10;        this.email = email;&#10;        this.phone = phone;&#10;        this.dateOfBirth = dateOfBirth;&#10;        this.gender = gender;&#10;        this.role = role;&#10;    }&#10;&#10;    // Getters and Setters&#10;    public String getId() {&#10;        return id;&#10;    }&#10;&#10;    public void setId(String id) {&#10;        this.id = id;&#10;    }&#10;&#10;    public String getName() {&#10;        return name;&#10;    }&#10;&#10;    public void setName(String name) {&#10;        this.name = name;&#10;    }&#10;&#10;    public String getEmail() {&#10;        return email;&#10;    }&#10;&#10;    public void setEmail(String email) {&#10;        this.email = email;&#10;    }&#10;&#10;    public String getPhone() {&#10;        return phone;&#10;    }&#10;&#10;    public void setPhone(String phone) {&#10;        this.phone = phone;&#10;    }&#10;&#10;    public String getDateOfBirth() {&#10;        return dateOfBirth;&#10;    }&#10;&#10;    public void setDateOfBirth(String dateOfBirth) {&#10;        this.dateOfBirth = dateOfBirth;&#10;    }&#10;&#10;    public String getGender() {&#10;        return gender;&#10;    }&#10;&#10;    public void setGender(String gender) {&#10;        this.gender = gender;&#10;    }&#10;&#10;    public String getRole() {&#10;        return role;&#10;    }&#10;&#10;    public void setRole(String role) {&#10;        this.role = role;&#10;    }&#10;&#10;    public String getCreatedAt() {&#10;        return createdAt;&#10;    }&#10;&#10;    public void setCreatedAt(String createdAt) {&#10;        this.createdAt = createdAt;&#10;    }&#10;&#10;    public String getUpdatedAt() {&#10;        return updatedAt;&#10;    }&#10;&#10;    public void setUpdatedAt(String updatedAt) {&#10;        this.updatedAt = updatedAt;&#10;    }&#10;&#10;    // Verification helpers - updated to use &quot;verified&quot; field&#10;    public Boolean getIsVerified() {&#10;        return verified != null ? verified : false;&#10;    }&#10;&#10;    public void setIsVerified(Boolean verified) {&#10;        this.verified = verified;&#10;    }&#10;&#10;    public Boolean getVerified() {&#10;        return verified != null ? verified : false;&#10;    }&#10;&#10;    public void setVerified(Boolean verified) {&#10;        this.verified = verified;&#10;    }&#10;&#10;    public String getVerifiedAt() {&#10;        return verifiedAt;&#10;    }&#10;&#10;    public void setVerifiedAt(String verifiedAt) {&#10;        this.verifiedAt = verifiedAt;&#10;    }&#10;&#10;    public Kyc getKyc() { return kyc; }&#10;    public void setKyc(Kyc kyc) { this.kyc = kyc; }&#10;&#10;    /**&#10;     * Returns a simple verification status string: &quot;verified&quot;, &quot;pending&quot;, or &quot;unverified&quot;&#10;     */&#10;    public String getVerificationStatus() {&#10;        // If verified is true and has verifiedAt date, user is fully verified&#10;        if (verified != null &amp;&amp; verified &amp;&amp; verifiedAt != null) {&#10;            return &quot;verified&quot;;&#10;        }&#10;        // If has KYC images uploaded but not yet verified, status is pending&#10;        if (kyc != null &amp;&amp;&#10;            kyc.getIdFrontImage() != null &amp;&amp;&#10;            kyc.getIdBackImage() != null &amp;&amp;&#10;            kyc.getLicenseFrontImage() != null &amp;&amp;&#10;            kyc.getLicenseBackImage() != null) {&#10;            return &quot;pending&quot;;&#10;        }&#10;        return &quot;unverified&quot;;&#10;    }&#10;&#10;    @Override&#10;    public String toString() {&#10;        return &quot;User{&quot; + &quot;id='&quot; + id + '\'' + &quot;, name='&quot; + name + '\'' + &quot;, email='&quot; + email + '\'' + &quot;, phone='&quot; + phone + '\'' + &quot;, dateOfBirth='&quot; + dateOfBirth + '\'' + &quot;, gender='&quot; + gender + '\'' + &quot;, role='&quot; + role + '\'' + &quot;, verified=&quot; + verified + '}';&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/ui/profile/ProfileViewModel.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/ui/profile/ProfileViewModel.java" />
              <option name="originalContent" value="package com.example.prm_project.ui.profile;&#10;&#10;import android.app.Application;&#10;import android.util.Log;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.lifecycle.AndroidViewModel;&#10;import androidx.lifecycle.LiveData;&#10;import androidx.lifecycle.MutableLiveData;&#10;&#10;import com.example.prm_project.api.ApiClient;&#10;import com.example.prm_project.api.UserApiService;&#10;import com.example.prm_project.models.ApiResponse;&#10;import com.example.prm_project.models.User;&#10;import com.example.prm_project.utils.SessionManager;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class ProfileViewModel extends AndroidViewModel {&#10;    private static final String TAG = &quot;ProfileViewModel&quot;;&#10;&#10;    private final MutableLiveData&lt;String&gt; mText;&#10;    private final MutableLiveData&lt;String&gt; name;&#10;    private final MutableLiveData&lt;String&gt; email;&#10;    private final MutableLiveData&lt;Integer&gt; ridesCount;&#10;    private final MutableLiveData&lt;Integer&gt; favCount;&#10;    private final MutableLiveData&lt;Integer&gt; reviewsCount;&#10;    private final MutableLiveData&lt;String&gt; distanceKm;&#10;    private final MutableLiveData&lt;Integer&gt; avatarResId;&#10;    private final MutableLiveData&lt;Integer&gt; coverResId;&#10;    private final MutableLiveData&lt;String&gt; birthDate;&#10;    private final MutableLiveData&lt;String&gt; phone;&#10;&#10;    // Loading and error states&#10;    private final MutableLiveData&lt;Boolean&gt; isLoading;&#10;    private final MutableLiveData&lt;String&gt; errorMessage;&#10;&#10;    private final UserApiService userApiService;&#10;    private final SessionManager sessionManager;&#10;&#10;    public ProfileViewModel(@NonNull Application application) {&#10;        super(application);&#10;&#10;        mText = new MutableLiveData&lt;&gt;();&#10;        mText.setValue(&quot;This is profile fragment&quot;);&#10;&#10;        // Initialize LiveData containers&#10;        name = new MutableLiveData&lt;&gt;();&#10;        email = new MutableLiveData&lt;&gt;();&#10;        ridesCount = new MutableLiveData&lt;&gt;();&#10;        favCount = new MutableLiveData&lt;&gt;();&#10;        reviewsCount = new MutableLiveData&lt;&gt;();&#10;        distanceKm = new MutableLiveData&lt;&gt;();&#10;        avatarResId = new MutableLiveData&lt;&gt;();&#10;        coverResId = new MutableLiveData&lt;&gt;();&#10;        birthDate = new MutableLiveData&lt;&gt;();&#10;        phone = new MutableLiveData&lt;&gt;();&#10;&#10;        isLoading = new MutableLiveData&lt;&gt;(false);&#10;        errorMessage = new MutableLiveData&lt;&gt;();&#10;&#10;        // Initialize API service and session manager&#10;        userApiService = ApiClient.getClient().create(UserApiService.class);&#10;        sessionManager = new SessionManager(application);&#10;&#10;        // Load initial data from API&#10;        loadUserProfile();&#10;    }&#10;&#10;    /**&#10;     * Load user profile from API&#10;     */&#10;    public void loadUserProfile() {&#10;        String token = sessionManager.getToken();&#10;&#10;        if (token == null || token.isEmpty()) {&#10;            Log.e(TAG, &quot;No token found, user not logged in&quot;);&#10;            errorMessage.setValue(&quot;Vui lòng đăng nhập lại&quot;);&#10;&#10;            // Fallback to dummy data for testing&#10;            reloadFromRepository();&#10;            return;&#10;        }&#10;&#10;        isLoading.setValue(true);&#10;        errorMessage.setValue(null);&#10;&#10;        Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.getUserProfile(&quot;Bearer &quot; + token);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                isLoading.setValue(false);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ApiResponse&lt;User&gt; apiResponse = response.body();&#10;&#10;                    if (apiResponse.isSuccess() &amp;&amp; apiResponse.getData() != null) {&#10;                        User user = apiResponse.getData();&#10;                        Log.d(TAG, &quot;Profile loaded successfully: &quot; + user.getName());&#10;&#10;                        // Update LiveData with API data&#10;                        name.setValue(user.getName() != null ? user.getName() : &quot;Unknown&quot;);&#10;                        email.setValue(user.getEmail() != null ? user.getEmail() : &quot;&quot;);&#10;                        phone.setValue(user.getPhone() != null ? user.getPhone() : &quot;&quot;);&#10;&#10;                        // Update session with latest data&#10;                        sessionManager.createLoginSession(user, token);&#10;&#10;                        // TODO: Get these from API when available&#10;                        ridesCount.setValue(0);&#10;                        favCount.setValue(0);&#10;                        reviewsCount.setValue(0);&#10;                        distanceKm.setValue(&quot;0 km&quot;);&#10;                    } else {&#10;                        Log.e(TAG, &quot;API returned success=false&quot;);&#10;                        errorMessage.setValue(&quot;Không thể tải thông tin profile&quot;);&#10;                        reloadFromRepository(); // Fallback to dummy&#10;                    }&#10;                } else {&#10;                    Log.e(TAG, &quot;API call failed with code: &quot; + response.code());&#10;                    errorMessage.setValue(&quot;Lỗi kết nối: &quot; + response.code());&#10;                    reloadFromRepository(); // Fallback to dummy&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                isLoading.setValue(false);&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;                errorMessage.setValue(&quot;Lỗi kết nối: &quot; + t.getMessage());&#10;                reloadFromRepository(); // Fallback to dummy&#10;            }&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Reloads profile data from the (dummy) repository. Call this to force-refresh&#10;     * values so observers get updated (useful during development when replacing resources).&#10;     */&#10;    public void reloadFromRepository() {&#10;        Profile p = DummyProfileRepository.getDummyProfile();&#10;&#10;        name.setValue(p.getName());&#10;        email.setValue(p.getEmail());&#10;        ridesCount.setValue(p.getRidesCount());&#10;        favCount.setValue(p.getFavCount());&#10;        reviewsCount.setValue(p.getReviewsCount());&#10;        distanceKm.setValue(p.getDistanceKm());&#10;        avatarResId.setValue(p.getAvatarResId());&#10;        coverResId.setValue(p.getCoverResId());&#10;        birthDate.setValue(p.getBirthDate());&#10;        phone.setValue(p.getPhone());&#10;    }&#10;&#10;    public LiveData&lt;String&gt; getText() {&#10;        return mText;&#10;    }&#10;&#10;    public LiveData&lt;String&gt; getName() { return name; }&#10;    public LiveData&lt;String&gt; getEmail() { return email; }&#10;    public LiveData&lt;Integer&gt; getRidesCount() { return ridesCount; }&#10;    public LiveData&lt;Integer&gt; getFavCount() { return favCount; }&#10;    public LiveData&lt;Integer&gt; getReviewsCount() { return reviewsCount; }&#10;    public LiveData&lt;String&gt; getDistanceKm() { return distanceKm; }&#10;    public LiveData&lt;Integer&gt; getAvatarResId() { return avatarResId; }&#10;    public LiveData&lt;Integer&gt; getCoverResId() { return coverResId; }&#10;    public LiveData&lt;String&gt; getBirthDate() { return birthDate; }&#10;    public LiveData&lt;String&gt; getPhone() { return phone; }&#10;&#10;    // Loading and error states&#10;    public LiveData&lt;Boolean&gt; getIsLoading() { return isLoading; }&#10;    public LiveData&lt;String&gt; getErrorMessage() { return errorMessage; }&#10;&#10;    // Setters so other fragments can update profile info (kept in-memory for now)&#10;    public void setName(String newName) { name.setValue(newName); }&#10;    public void setEmail(String newEmail) { email.setValue(newEmail); }&#10;    public void setRidesCount(int v) { ridesCount.setValue(v); }&#10;    public void setDistanceKm(String d) { distanceKm.setValue(d); }&#10;    public void setAvatarResId(int resId) { avatarResId.setValue(resId); }&#10;    public void setCoverResId(int resId) { coverResId.setValue(resId); }&#10;    public void setBirthDate(String value) { birthDate.setValue(value); }&#10;    public void setPhone(String value) { phone.setValue(value); }&#10;}" />
              <option name="updatedContent" value="package com.example.prm_project.ui.profile;&#10;&#10;import android.app.Application;&#10;import android.util.Log;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.lifecycle.AndroidViewModel;&#10;import androidx.lifecycle.LiveData;&#10;import androidx.lifecycle.MutableLiveData;&#10;&#10;import com.example.prm_project.api.ApiClient;&#10;import com.example.prm_project.api.UserApiService;&#10;import com.example.prm_project.models.ApiResponse;&#10;import com.example.prm_project.models.User;&#10;import com.example.prm_project.utils.SessionManager;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class ProfileViewModel extends AndroidViewModel {&#10;    private static final String TAG = &quot;ProfileViewModel&quot;;&#10;&#10;    private final MutableLiveData&lt;String&gt; mText;&#10;    private final MutableLiveData&lt;String&gt; name;&#10;    private final MutableLiveData&lt;String&gt; email;&#10;    private final MutableLiveData&lt;Integer&gt; ridesCount;&#10;    private final MutableLiveData&lt;Integer&gt; favCount;&#10;    private final MutableLiveData&lt;Integer&gt; reviewsCount;&#10;    private final MutableLiveData&lt;String&gt; distanceKm;&#10;    private final MutableLiveData&lt;Integer&gt; avatarResId;&#10;    private final MutableLiveData&lt;Integer&gt; coverResId;&#10;    private final MutableLiveData&lt;String&gt; birthDate;&#10;    private final MutableLiveData&lt;String&gt; phone;&#10;&#10;    // Loading and error states&#10;    private final MutableLiveData&lt;Boolean&gt; isLoading;&#10;    private final MutableLiveData&lt;String&gt; errorMessage;&#10;&#10;    private final UserApiService userApiService;&#10;    private final SessionManager sessionManager;&#10;&#10;    public ProfileViewModel(@NonNull Application application) {&#10;        super(application);&#10;&#10;        mText = new MutableLiveData&lt;&gt;();&#10;        mText.setValue(&quot;This is profile fragment&quot;);&#10;&#10;        // Initialize LiveData containers&#10;        name = new MutableLiveData&lt;&gt;();&#10;        email = new MutableLiveData&lt;&gt;();&#10;        ridesCount = new MutableLiveData&lt;&gt;();&#10;        favCount = new MutableLiveData&lt;&gt;();&#10;        reviewsCount = new MutableLiveData&lt;&gt;();&#10;        distanceKm = new MutableLiveData&lt;&gt;();&#10;        avatarResId = new MutableLiveData&lt;&gt;();&#10;        coverResId = new MutableLiveData&lt;&gt;();&#10;        birthDate = new MutableLiveData&lt;&gt;();&#10;        phone = new MutableLiveData&lt;&gt;();&#10;&#10;        isLoading = new MutableLiveData&lt;&gt;(false);&#10;        errorMessage = new MutableLiveData&lt;&gt;();&#10;&#10;        // Initialize API service and session manager&#10;        userApiService = ApiClient.getClient().create(UserApiService.class);&#10;        sessionManager = new SessionManager(application);&#10;&#10;        // Load initial data from API&#10;        loadUserProfile();&#10;    }&#10;&#10;    /**&#10;     * Load user profile from API&#10;     */&#10;    public void loadUserProfile() {&#10;        String token = sessionManager.getToken();&#10;&#10;        if (token == null || token.isEmpty()) {&#10;            Log.e(TAG, &quot;No token found, user not logged in&quot;);&#10;            errorMessage.setValue(&quot;Vui lòng đăng nhập lại&quot;);&#10;&#10;            // Fallback to dummy data for testing&#10;            reloadFromRepository();&#10;            return;&#10;        }&#10;&#10;        isLoading.setValue(true);&#10;        errorMessage.setValue(null);&#10;&#10;        Call&lt;ApiResponse&lt;User&gt;&gt; call = userApiService.getUserProfile(&quot;Bearer &quot; + token);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;User&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;User&gt;&gt; call, Response&lt;ApiResponse&lt;User&gt;&gt; response) {&#10;                isLoading.setValue(false);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ApiResponse&lt;User&gt; apiResponse = response.body();&#10;&#10;                    if (apiResponse.isSuccess() &amp;&amp; apiResponse.getData() != null) {&#10;                        User user = apiResponse.getData();&#10;                        Log.d(TAG, &quot;Profile loaded successfully: &quot; + user.getName());&#10;&#10;                        // Update LiveData with API data&#10;                        name.setValue(user.getName() != null ? user.getName() : &quot;Unknown&quot;);&#10;                        email.setValue(user.getEmail() != null ? user.getEmail() : &quot;&quot;);&#10;                        phone.setValue(user.getPhone() != null ? user.getPhone() : &quot;&quot;);&#10;                        birthDate.setValue(user.getDateOfBirth() != null ? user.getDateOfBirth() : &quot;&quot;);&#10;&#10;                        // Update session with latest data&#10;                        sessionManager.createLoginSession(user, token);&#10;&#10;                        // TODO: Get these from API when available&#10;                        ridesCount.setValue(0);&#10;                        favCount.setValue(0);&#10;                        reviewsCount.setValue(0);&#10;                        distanceKm.setValue(&quot;0 km&quot;);&#10;                    } else {&#10;                        Log.e(TAG, &quot;API returned success=false&quot;);&#10;                        errorMessage.setValue(&quot;Không thể tải thông tin profile&quot;);&#10;                        reloadFromRepository(); // Fallback to dummy&#10;                    }&#10;                } else {&#10;                    Log.e(TAG, &quot;API call failed with code: &quot; + response.code());&#10;                    errorMessage.setValue(&quot;Lỗi kết nối: &quot; + response.code());&#10;                    reloadFromRepository(); // Fallback to dummy&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;User&gt;&gt; call, Throwable t) {&#10;                isLoading.setValue(false);&#10;                Log.e(TAG, &quot;API call failed&quot;, t);&#10;                errorMessage.setValue(&quot;Lỗi kết nối: &quot; + t.getMessage());&#10;                reloadFromRepository(); // Fallback to dummy&#10;            }&#10;        });&#10;    }&#10;&#10;    /**&#10;     * Reloads profile data from the (dummy) repository. Call this to force-refresh&#10;     * values so observers get updated (useful during development when replacing resources).&#10;     */&#10;    public void reloadFromRepository() {&#10;        Profile p = DummyProfileRepository.getDummyProfile();&#10;&#10;        name.setValue(p.getName());&#10;        email.setValue(p.getEmail());&#10;        ridesCount.setValue(p.getRidesCount());&#10;        favCount.setValue(p.getFavCount());&#10;        reviewsCount.setValue(p.getReviewsCount());&#10;        distanceKm.setValue(p.getDistanceKm());&#10;        avatarResId.setValue(p.getAvatarResId());&#10;        coverResId.setValue(p.getCoverResId());&#10;        birthDate.setValue(p.getBirthDate());&#10;        phone.setValue(p.getPhone());&#10;    }&#10;&#10;    public LiveData&lt;String&gt; getText() {&#10;        return mText;&#10;    }&#10;&#10;    public LiveData&lt;String&gt; getName() { return name; }&#10;    public LiveData&lt;String&gt; getEmail() { return email; }&#10;    public LiveData&lt;Integer&gt; getRidesCount() { return ridesCount; }&#10;    public LiveData&lt;Integer&gt; getFavCount() { return favCount; }&#10;    public LiveData&lt;Integer&gt; getReviewsCount() { return reviewsCount; }&#10;    public LiveData&lt;String&gt; getDistanceKm() { return distanceKm; }&#10;    public LiveData&lt;Integer&gt; getAvatarResId() { return avatarResId; }&#10;    public LiveData&lt;Integer&gt; getCoverResId() { return coverResId; }&#10;    public LiveData&lt;String&gt; getBirthDate() { return birthDate; }&#10;    public LiveData&lt;String&gt; getPhone() { return phone; }&#10;&#10;    // Loading and error states&#10;    public LiveData&lt;Boolean&gt; getIsLoading() { return isLoading; }&#10;    public LiveData&lt;String&gt; getErrorMessage() { return errorMessage; }&#10;&#10;    // Setters so other fragments can update profile info (kept in-memory for now)&#10;    public void setName(String newName) { name.setValue(newName); }&#10;    public void setEmail(String newEmail) { email.setValue(newEmail); }&#10;    public void setRidesCount(int v) { ridesCount.setValue(v); }&#10;    public void setDistanceKm(String d) { distanceKm.setValue(d); }&#10;    public void setAvatarResId(int resId) { avatarResId.setValue(resId); }&#10;    public void setCoverResId(int resId) { coverResId.setValue(resId); }&#10;    public void setBirthDate(String value) { birthDate.setValue(value); }&#10;    public void setPhone(String value) { phone.setValue(value); }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/utils/SessionManager.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/prm_project/utils/SessionManager.java" />
              <option name="originalContent" value="package com.example.prm_project.utils;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;&#10;import com.example.prm_project.models.User;&#10;&#10;/**&#10; * Session Manager để lưu trữ và quản lý thông tin user session&#10; */&#10;public class SessionManager {&#10;    private static final String PREF_NAME = &quot;UserSession&quot;;&#10;    private static final String KEY_IS_LOGGED_IN = &quot;isLoggedIn&quot;;&#10;    private static final String KEY_USER_ID = &quot;userId&quot;;&#10;    private static final String KEY_USER_NAME = &quot;userName&quot;;&#10;    private static final String KEY_USER_EMAIL = &quot;userEmail&quot;;&#10;    private static final String KEY_USER_PHONE = &quot;userPhone&quot;;&#10;    private static final String KEY_USER_GENDER = &quot;userGender&quot;;&#10;    private static final String KEY_USER_ROLE = &quot;userRole&quot;;&#10;    private static final String KEY_TOKEN = &quot;token&quot;;&#10;    private static final String KEY_IS_VERIFIED = &quot;isVerified&quot;;&#10;    private static final String KEY_KYC_STATUS = &quot;kycStatus&quot;;&#10;&#10;    private SharedPreferences prefs;&#10;    private SharedPreferences.Editor editor;&#10;    private Context context;&#10;&#10;    public SessionManager(Context context) {&#10;        this.context = context;&#10;        prefs = context.getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);&#10;        editor = prefs.edit();&#10;    }&#10;&#10;    /**&#10;     * Lưu thông tin user sau khi login/register thành công&#10;     */&#10;    public void createLoginSession(User user, String token) {&#10;        editor.putBoolean(KEY_IS_LOGGED_IN, true);&#10;        editor.putString(KEY_USER_ID, user.getId());&#10;        editor.putString(KEY_USER_NAME, user.getName());&#10;        editor.putString(KEY_USER_EMAIL, user.getEmail());&#10;        editor.putString(KEY_USER_PHONE, user.getPhone());&#10;        editor.putString(KEY_USER_GENDER, user.getGender());&#10;        editor.putString(KEY_USER_ROLE, user.getRole());&#10;        editor.putString(KEY_TOKEN, token);&#10;&#10;        // Save verification info - now correctly using &quot;verified&quot; field from backend&#10;        editor.putBoolean(KEY_IS_VERIFIED, user.getVerified());&#10;&#10;        // Save KYC status based on verification logic&#10;        String kycStatus = user.getVerificationStatus();&#10;        editor.putString(KEY_KYC_STATUS, kycStatus);&#10;&#10;        editor.apply();&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra user đã login chưa&#10;     */&#10;    public boolean isLoggedIn() {&#10;        return prefs.getBoolean(KEY_IS_LOGGED_IN, false);&#10;    }&#10;&#10;    /**&#10;     * Lấy thông tin user&#10;     */&#10;    public User getUserDetails() {&#10;        if (!isLoggedIn()) {&#10;            return null;&#10;        }&#10;&#10;        User user = new User();&#10;        user.setId(prefs.getString(KEY_USER_ID, &quot;&quot;));&#10;        user.setName(prefs.getString(KEY_USER_NAME, &quot;&quot;));&#10;        user.setEmail(prefs.getString(KEY_USER_EMAIL, &quot;&quot;));&#10;        user.setPhone(prefs.getString(KEY_USER_PHONE, &quot;&quot;));&#10;        user.setGender(prefs.getString(KEY_USER_GENDER, &quot;&quot;));&#10;        user.setRole(prefs.getString(KEY_USER_ROLE, &quot;&quot;));&#10;&#10;        // restore verification info&#10;        boolean isVerified = prefs.getBoolean(KEY_IS_VERIFIED, false);&#10;        user.setVerified(isVerified);&#10;&#10;        return user;&#10;    }&#10;&#10;    /**&#10;     * Lấy token&#10;     */&#10;    public String getToken() {&#10;        return prefs.getString(KEY_TOKEN, null);&#10;    }&#10;&#10;    /**&#10;     * Lấy user ID&#10;     */&#10;    public String getUserId() {&#10;        return prefs.getString(KEY_USER_ID, &quot;&quot;);&#10;    }&#10;&#10;    /**&#10;     * Lấy user name&#10;     */&#10;    public String getUserName() {&#10;        return prefs.getString(KEY_USER_NAME, &quot;&quot;);&#10;    }&#10;&#10;    /**&#10;     * Lấy user email&#10;     */&#10;    public String getUserEmail() {&#10;        return prefs.getString(KEY_USER_EMAIL, &quot;&quot;);&#10;    }&#10;&#10;    /**&#10;     * Get whether user has been verified&#10;     */&#10;    public boolean isVerified() {&#10;        return prefs.getBoolean(KEY_IS_VERIFIED, false);&#10;    }&#10;&#10;    /**&#10;     * Get KYC status string (e.g., &quot;pending&quot;, &quot;verified&quot;)&#10;     */&#10;    public String getKycStatus() {&#10;        return prefs.getString(KEY_KYC_STATUS, &quot;unverified&quot;);&#10;    }&#10;&#10;    /**&#10;     * Logout user - xóa tất cả session data&#10;     */&#10;    public void logout() {&#10;        editor.clear();&#10;        editor.apply();&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.prm_project.utils;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;&#10;import com.example.prm_project.models.User;&#10;&#10;/**&#10; * Session Manager để lưu trữ và quản lý thông tin user session&#10; */&#10;public class SessionManager {&#10;    private static final String PREF_NAME = &quot;UserSession&quot;;&#10;    private static final String KEY_IS_LOGGED_IN = &quot;isLoggedIn&quot;;&#10;    private static final String KEY_USER_ID = &quot;userId&quot;;&#10;    private static final String KEY_USER_NAME = &quot;userName&quot;;&#10;    private static final String KEY_USER_EMAIL = &quot;userEmail&quot;;&#10;    private static final String KEY_USER_PHONE = &quot;userPhone&quot;;&#10;    private static final String KEY_USER_DATE_OF_BIRTH = &quot;userDateOfBirth&quot;;&#10;    private static final String KEY_USER_GENDER = &quot;userGender&quot;;&#10;    private static final String KEY_USER_ROLE = &quot;userRole&quot;;&#10;    private static final String KEY_TOKEN = &quot;token&quot;;&#10;    private static final String KEY_IS_VERIFIED = &quot;isVerified&quot;;&#10;    private static final String KEY_KYC_STATUS = &quot;kycStatus&quot;;&#10;&#10;    private SharedPreferences prefs;&#10;    private SharedPreferences.Editor editor;&#10;    private Context context;&#10;&#10;    public SessionManager(Context context) {&#10;        this.context = context;&#10;        prefs = context.getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);&#10;        editor = prefs.edit();&#10;    }&#10;&#10;    /**&#10;     * Lưu thông tin user sau khi login/register thành công&#10;     */&#10;    public void createLoginSession(User user, String token) {&#10;        editor.putBoolean(KEY_IS_LOGGED_IN, true);&#10;        editor.putString(KEY_USER_ID, user.getId());&#10;        editor.putString(KEY_USER_NAME, user.getName());&#10;        editor.putString(KEY_USER_EMAIL, user.getEmail());&#10;        editor.putString(KEY_USER_PHONE, user.getPhone());&#10;        editor.putString(KEY_USER_DATE_OF_BIRTH, user.getDateOfBirth());&#10;        editor.putString(KEY_USER_GENDER, user.getGender());&#10;        editor.putString(KEY_USER_ROLE, user.getRole());&#10;        editor.putString(KEY_TOKEN, token);&#10;&#10;        // Save verification info - now correctly using &quot;verified&quot; field from backend&#10;        editor.putBoolean(KEY_IS_VERIFIED, user.getVerified());&#10;&#10;        // Save KYC status based on verification logic&#10;        String kycStatus = user.getVerificationStatus();&#10;        editor.putString(KEY_KYC_STATUS, kycStatus);&#10;&#10;        editor.apply();&#10;    }&#10;&#10;    /**&#10;     * Kiểm tra user đã login chưa&#10;     */&#10;    public boolean isLoggedIn() {&#10;        return prefs.getBoolean(KEY_IS_LOGGED_IN, false);&#10;    }&#10;&#10;    /**&#10;     * Lấy thông tin user&#10;     */&#10;    public User getUserDetails() {&#10;        if (!isLoggedIn()) {&#10;            return null;&#10;        }&#10;&#10;        User user = new User();&#10;        user.setId(prefs.getString(KEY_USER_ID, &quot;&quot;));&#10;        user.setName(prefs.getString(KEY_USER_NAME, &quot;&quot;));&#10;        user.setEmail(prefs.getString(KEY_USER_EMAIL, &quot;&quot;));&#10;        user.setPhone(prefs.getString(KEY_USER_PHONE, &quot;&quot;));&#10;        user.setDateOfBirth(prefs.getString(KEY_USER_DATE_OF_BIRTH, &quot;&quot;));&#10;        user.setGender(prefs.getString(KEY_USER_GENDER, &quot;&quot;));&#10;        user.setRole(prefs.getString(KEY_USER_ROLE, &quot;&quot;));&#10;&#10;        // restore verification info&#10;        boolean isVerified = prefs.getBoolean(KEY_IS_VERIFIED, false);&#10;        user.setVerified(isVerified);&#10;&#10;        return user;&#10;    }&#10;&#10;    /**&#10;     * Lấy token&#10;     */&#10;    public String getToken() {&#10;        return prefs.getString(KEY_TOKEN, null);&#10;    }&#10;&#10;    /**&#10;     * Lấy user ID&#10;     */&#10;    public String getUserId() {&#10;        return prefs.getString(KEY_USER_ID, &quot;&quot;);&#10;    }&#10;&#10;    /**&#10;     * Lấy user name&#10;     */&#10;    public String getUserName() {&#10;        return prefs.getString(KEY_USER_NAME, &quot;&quot;);&#10;    }&#10;&#10;    /**&#10;     * Lấy user email&#10;     */&#10;    public String getUserEmail() {&#10;        return prefs.getString(KEY_USER_EMAIL, &quot;&quot;);&#10;    }&#10;&#10;    /**&#10;     * Get whether user has been verified&#10;     */&#10;    public boolean isVerified() {&#10;        return prefs.getBoolean(KEY_IS_VERIFIED, false);&#10;    }&#10;&#10;    /**&#10;     * Get KYC status string (e.g., &quot;pending&quot;, &quot;verified&quot;)&#10;     */&#10;    public String getKycStatus() {&#10;        return prefs.getString(KEY_KYC_STATUS, &quot;unverified&quot;);&#10;    }&#10;&#10;    /**&#10;     * Logout user - xóa tất cả session data&#10;     */&#10;    public void logout() {&#10;        editor.clear();&#10;        editor.apply();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/drawable/ic_chevron_right_24dp.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/drawable/ic_chevron_right_24dp.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#2196F3&quot;&#10;        android:pathData=&quot;M9.29,6.71a1,1 0 0,0 0,1.41L13.17,12l-3.88,3.88a1,1 0 1,0 1.41,1.41l4.59,-4.59a1,1 0 0,0 0,-1.41l-4.59,-4.59a1,1 0 0,0 -1.41,0z&quot;/&gt;&#10;&lt;/vector&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#2196F3&quot;&#10;        android:pathData=&quot;M9.29,6.71a1,1 0 0,0 0,1.41L13.17,12l-3.88,3.88a1,1 0 1,0 1.41,1.41l4.59,-4.59a1,1 0 0,0 0,-1.41l-4.59,-4.59a1,1 0 0,0 -1.41,0z&quot;/&gt;&#10;&lt;/vector&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>